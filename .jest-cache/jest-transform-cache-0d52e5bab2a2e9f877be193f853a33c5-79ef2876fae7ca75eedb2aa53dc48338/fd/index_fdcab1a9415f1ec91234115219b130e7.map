{"version":3,"names":["Object","defineProperty","exports","value","buttons","require","device","mouse","pointer","_define_property","obj","key","enumerable","configurable","writable","PointerHost","isKeyPressed","keyDef","devices","get","pointerType","isPressed","press","instance","position","pointerName","getPointerName","pointers","new","init","addPressed","down","isPrevented","move","pointermove","mousemove","isDown","undefined","leave","enter","release","removePressed","up","countPressed","isMultitouch","name","getPreviousPosition","has","resetClickCount","getMouseTarget","_this_mouse_position_target","target","config","document","body","setMousePosition","constructor","system","k","_this_registry","_k","_","registry","Device","isPrimary","values","some","p","isCancelled","forEach","Pointer","pointerId","nextId","Error","Buttons","Mouse"],"sources":["index.js"],"sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar buttons = require('./buttons.js');\nvar device = require('./device.js');\nvar mouse = require('./mouse.js');\nvar pointer = require('./pointer.js');\n\nfunction _define_property(obj, key, value) {\n    if (key in obj) {\n        Object.defineProperty(obj, key, {\n            value: value,\n            enumerable: true,\n            configurable: true,\n            writable: true\n        });\n    } else {\n        obj[key] = value;\n    }\n    return obj;\n}\nclass PointerHost {\n    isKeyPressed(keyDef) {\n        return this.devices.get(keyDef.pointerType).isPressed(keyDef);\n    }\n    async press(instance, keyDef, position) {\n        const pointerName = this.getPointerName(keyDef);\n        const pointer = keyDef.pointerType === 'touch' ? this.pointers.new(pointerName, keyDef).init(instance, position) : this.pointers.get(pointerName);\n        // TODO: deprecate the following implicit setting of position\n        pointer.position = position;\n        if (pointer.pointerType !== 'touch') {\n            this.mouse.position = position;\n        }\n        this.devices.get(keyDef.pointerType).addPressed(keyDef);\n        this.buttons.down(keyDef);\n        pointer.down(instance, keyDef);\n        if (pointer.pointerType !== 'touch' && !pointer.isPrevented) {\n            this.mouse.down(instance, keyDef, pointer);\n        }\n    }\n    async move(instance, pointerName, position) {\n        const pointer = this.pointers.get(pointerName);\n        // In (some?) browsers this order of events can be observed.\n        // This interweaving of events is probably unnecessary.\n        // While the order of mouse (or pointer) events is defined per spec,\n        // the order in which they interweave/follow on a user interaction depends on the implementation.\n        const pointermove = pointer.move(instance, position);\n        const mousemove = pointer.pointerType === 'touch' || pointer.isPrevented && pointer.isDown ? undefined : this.mouse.move(instance, position);\n        pointermove === null || pointermove === void 0 ? void 0 : pointermove.leave();\n        mousemove === null || mousemove === void 0 ? void 0 : mousemove.leave();\n        pointermove === null || pointermove === void 0 ? void 0 : pointermove.enter();\n        mousemove === null || mousemove === void 0 ? void 0 : mousemove.enter();\n        pointermove === null || pointermove === void 0 ? void 0 : pointermove.move();\n        mousemove === null || mousemove === void 0 ? void 0 : mousemove.move();\n    }\n    async release(instance, keyDef, position) {\n        const device = this.devices.get(keyDef.pointerType);\n        device.removePressed(keyDef);\n        this.buttons.up(keyDef);\n        const pointer = this.pointers.get(this.getPointerName(keyDef));\n        // TODO: deprecate the following implicit setting of position\n        pointer.position = position;\n        if (pointer.pointerType !== 'touch') {\n            this.mouse.position = position;\n        }\n        if (device.countPressed === 0) {\n            pointer.up(instance, keyDef);\n        }\n        if (pointer.pointerType === 'touch') {\n            pointer.release(instance);\n        }\n        if (!pointer.isPrevented) {\n            if (pointer.pointerType === 'touch' && !pointer.isMultitouch) {\n                const mousemove = this.mouse.move(instance, pointer.position);\n                mousemove === null || mousemove === void 0 ? void 0 : mousemove.leave();\n                mousemove === null || mousemove === void 0 ? void 0 : mousemove.enter();\n                mousemove === null || mousemove === void 0 ? void 0 : mousemove.move();\n                this.mouse.down(instance, keyDef, pointer);\n            }\n            if (!pointer.isMultitouch) {\n                const mousemove = this.mouse.move(instance, pointer.position);\n                mousemove === null || mousemove === void 0 ? void 0 : mousemove.leave();\n                mousemove === null || mousemove === void 0 ? void 0 : mousemove.enter();\n                mousemove === null || mousemove === void 0 ? void 0 : mousemove.move();\n                this.mouse.up(instance, keyDef, pointer);\n            }\n        }\n    }\n    getPointerName(keyDef) {\n        return keyDef.pointerType === 'touch' ? keyDef.name : keyDef.pointerType;\n    }\n    getPreviousPosition(pointerName) {\n        return this.pointers.has(pointerName) ? this.pointers.get(pointerName).position : undefined;\n    }\n    resetClickCount() {\n        this.mouse.resetClickCount();\n    }\n    getMouseTarget(instance) {\n        var _this_mouse_position_target;\n        return (_this_mouse_position_target = this.mouse.position.target) !== null && _this_mouse_position_target !== void 0 ? _this_mouse_position_target : instance.config.document.body;\n    }\n    setMousePosition(position) {\n        this.mouse.position = position;\n        this.pointers.get('mouse').position = position;\n    }\n    constructor(system){\n        _define_property(this, \"system\", void 0);\n        _define_property(this, \"mouse\", void 0);\n        _define_property(this, \"buttons\", void 0);\n        _define_property(this, \"devices\", new class {\n            get(k) {\n                var // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n                _this_registry, _k;\n                var _;\n                (_ = (_this_registry = this.registry)[_k = k]) !== null && _ !== void 0 ? _ : _this_registry[_k] = new device.Device();\n                return this.registry[k];\n            }\n            constructor(){\n                _define_property(this, \"registry\", {});\n            }\n        }());\n        _define_property(this, \"pointers\", new class {\n            new(pointerName, keyDef) {\n                const isPrimary = keyDef.pointerType !== 'touch' || !Object.values(this.registry).some((p)=>p.pointerType === 'touch' && !p.isCancelled);\n                if (!isPrimary) {\n                    Object.values(this.registry).forEach((p)=>{\n                        if (p.pointerType === keyDef.pointerType && !p.isCancelled) {\n                            p.isMultitouch = true;\n                        }\n                    });\n                }\n                this.registry[pointerName] = new pointer.Pointer({\n                    pointerId: this.nextId++,\n                    pointerType: keyDef.pointerType,\n                    isPrimary\n                });\n                return this.registry[pointerName];\n            }\n            get(pointerName) {\n                if (!this.has(pointerName)) {\n                    throw new Error(`Trying to access pointer \"${pointerName}\" which does not exist.`);\n                }\n                return this.registry[pointerName];\n            }\n            has(pointerName) {\n                return pointerName in this.registry;\n            }\n            constructor(){\n                _define_property(this, \"registry\", {\n                    mouse: new pointer.Pointer({\n                        pointerId: 1,\n                        pointerType: 'mouse',\n                        isPrimary: true\n                    })\n                });\n                _define_property(this, \"nextId\", 2);\n            }\n        }());\n        this.system = system;\n        this.buttons = new buttons.Buttons();\n        this.mouse = new mouse.Mouse();\n    }\n}\n\nexports.PointerHost = PointerHost;\n"],"mappings":"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"}