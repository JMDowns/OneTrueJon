5b4ff89a02f809a3a148475c3f9bbc21
'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});
var isDisabled = require('../misc/isDisabled.js');
var isElementType = require('../misc/isElementType.js');
var isVisible = require('../misc/isVisible.js');
var selector = require('./selector.js');
function getTabDestination(activeElement, shift) {
  const document = activeElement.ownerDocument;
  const focusableElements = document.querySelectorAll(selector.FOCUSABLE_SELECTOR);
  const enabledElements = Array.from(focusableElements).filter(el => el === activeElement || !(Number(el.getAttribute('tabindex')) < 0 || isDisabled.isDisabled(el)));
  // tabindex has no effect if the active element has negative tabindex
  if (Number(activeElement.getAttribute('tabindex')) >= 0) {
    enabledElements.sort((a, b) => {
      const i = Number(a.getAttribute('tabindex'));
      const j = Number(b.getAttribute('tabindex'));
      if (i === j) {
        return 0;
      } else if (i === 0) {
        return 1;
      } else if (j === 0) {
        return -1;
      }
      return i - j;
    });
  }
  const checkedRadio = {};
  let prunedElements = [document.body];
  const activeRadioGroup = isElementType.isElementType(activeElement, 'input', {
    type: 'radio'
  }) ? activeElement.name : undefined;
  enabledElements.forEach(currentElement => {
    const el = currentElement;
    // For radio groups keep only the active radio
    // If there is no active radio, keep only the checked radio
    // If there is no checked radio, treat like everything else
    if (isElementType.isElementType(el, 'input', {
      type: 'radio'
    }) && el.name) {
      // If the active element is part of the group, add only that
      if (el === activeElement) {
        prunedElements.push(el);
        return;
      } else if (el.name === activeRadioGroup) {
        return;
      }
      // If we stumble upon a checked radio, remove the others
      if (el.checked) {
        prunedElements = prunedElements.filter(e => !isElementType.isElementType(e, 'input', {
          type: 'radio',
          name: el.name
        }));
        prunedElements.push(el);
        checkedRadio[el.name] = el;
        return;
      }
      // If we already found the checked one, skip
      if (typeof checkedRadio[el.name] !== 'undefined') {
        return;
      }
    }
    prunedElements.push(el);
  });
  for (let index = prunedElements.findIndex(el => el === activeElement);;) {
    index += shift ? -1 : 1;
    // loop at overflow
    if (index === prunedElements.length) {
      index = 0;
    } else if (index === -1) {
      index = prunedElements.length - 1;
    }
    if (prunedElements[index] === activeElement || prunedElements[index] === document.body || isVisible.isVisible(prunedElements[index])) {
      return prunedElements[index];
    }
  }
}
exports.getTabDestination = getTabDestination;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsImlzRGlzYWJsZWQiLCJyZXF1aXJlIiwiaXNFbGVtZW50VHlwZSIsImlzVmlzaWJsZSIsInNlbGVjdG9yIiwiZ2V0VGFiRGVzdGluYXRpb24iLCJhY3RpdmVFbGVtZW50Iiwic2hpZnQiLCJkb2N1bWVudCIsIm93bmVyRG9jdW1lbnQiLCJmb2N1c2FibGVFbGVtZW50cyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJGT0NVU0FCTEVfU0VMRUNUT1IiLCJlbmFibGVkRWxlbWVudHMiLCJBcnJheSIsImZyb20iLCJmaWx0ZXIiLCJlbCIsIk51bWJlciIsImdldEF0dHJpYnV0ZSIsInNvcnQiLCJhIiwiYiIsImkiLCJqIiwiY2hlY2tlZFJhZGlvIiwicHJ1bmVkRWxlbWVudHMiLCJib2R5IiwiYWN0aXZlUmFkaW9Hcm91cCIsInR5cGUiLCJuYW1lIiwidW5kZWZpbmVkIiwiZm9yRWFjaCIsImN1cnJlbnRFbGVtZW50IiwicHVzaCIsImNoZWNrZWQiLCJlIiwiaW5kZXgiLCJmaW5kSW5kZXgiLCJsZW5ndGgiXSwic291cmNlcyI6WyJnZXRUYWJEZXN0aW5hdGlvbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG5cbnZhciBpc0Rpc2FibGVkID0gcmVxdWlyZSgnLi4vbWlzYy9pc0Rpc2FibGVkLmpzJyk7XG52YXIgaXNFbGVtZW50VHlwZSA9IHJlcXVpcmUoJy4uL21pc2MvaXNFbGVtZW50VHlwZS5qcycpO1xudmFyIGlzVmlzaWJsZSA9IHJlcXVpcmUoJy4uL21pc2MvaXNWaXNpYmxlLmpzJyk7XG52YXIgc2VsZWN0b3IgPSByZXF1aXJlKCcuL3NlbGVjdG9yLmpzJyk7XG5cbmZ1bmN0aW9uIGdldFRhYkRlc3RpbmF0aW9uKGFjdGl2ZUVsZW1lbnQsIHNoaWZ0KSB7XG4gICAgY29uc3QgZG9jdW1lbnQgPSBhY3RpdmVFbGVtZW50Lm93bmVyRG9jdW1lbnQ7XG4gICAgY29uc3QgZm9jdXNhYmxlRWxlbWVudHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yLkZPQ1VTQUJMRV9TRUxFQ1RPUik7XG4gICAgY29uc3QgZW5hYmxlZEVsZW1lbnRzID0gQXJyYXkuZnJvbShmb2N1c2FibGVFbGVtZW50cykuZmlsdGVyKChlbCk9PmVsID09PSBhY3RpdmVFbGVtZW50IHx8ICEoTnVtYmVyKGVsLmdldEF0dHJpYnV0ZSgndGFiaW5kZXgnKSkgPCAwIHx8IGlzRGlzYWJsZWQuaXNEaXNhYmxlZChlbCkpKTtcbiAgICAvLyB0YWJpbmRleCBoYXMgbm8gZWZmZWN0IGlmIHRoZSBhY3RpdmUgZWxlbWVudCBoYXMgbmVnYXRpdmUgdGFiaW5kZXhcbiAgICBpZiAoTnVtYmVyKGFjdGl2ZUVsZW1lbnQuZ2V0QXR0cmlidXRlKCd0YWJpbmRleCcpKSA+PSAwKSB7XG4gICAgICAgIGVuYWJsZWRFbGVtZW50cy5zb3J0KChhLCBiKT0+e1xuICAgICAgICAgICAgY29uc3QgaSA9IE51bWJlcihhLmdldEF0dHJpYnV0ZSgndGFiaW5kZXgnKSk7XG4gICAgICAgICAgICBjb25zdCBqID0gTnVtYmVyKGIuZ2V0QXR0cmlidXRlKCd0YWJpbmRleCcpKTtcbiAgICAgICAgICAgIGlmIChpID09PSBqKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGkgPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaiA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBpIC0gajtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IGNoZWNrZWRSYWRpbyA9IHt9O1xuICAgIGxldCBwcnVuZWRFbGVtZW50cyA9IFtcbiAgICAgICAgZG9jdW1lbnQuYm9keVxuICAgIF07XG4gICAgY29uc3QgYWN0aXZlUmFkaW9Hcm91cCA9IGlzRWxlbWVudFR5cGUuaXNFbGVtZW50VHlwZShhY3RpdmVFbGVtZW50LCAnaW5wdXQnLCB7XG4gICAgICAgIHR5cGU6ICdyYWRpbydcbiAgICB9KSA/IGFjdGl2ZUVsZW1lbnQubmFtZSA6IHVuZGVmaW5lZDtcbiAgICBlbmFibGVkRWxlbWVudHMuZm9yRWFjaCgoY3VycmVudEVsZW1lbnQpPT57XG4gICAgICAgIGNvbnN0IGVsID0gY3VycmVudEVsZW1lbnQ7XG4gICAgICAgIC8vIEZvciByYWRpbyBncm91cHMga2VlcCBvbmx5IHRoZSBhY3RpdmUgcmFkaW9cbiAgICAgICAgLy8gSWYgdGhlcmUgaXMgbm8gYWN0aXZlIHJhZGlvLCBrZWVwIG9ubHkgdGhlIGNoZWNrZWQgcmFkaW9cbiAgICAgICAgLy8gSWYgdGhlcmUgaXMgbm8gY2hlY2tlZCByYWRpbywgdHJlYXQgbGlrZSBldmVyeXRoaW5nIGVsc2VcbiAgICAgICAgaWYgKGlzRWxlbWVudFR5cGUuaXNFbGVtZW50VHlwZShlbCwgJ2lucHV0Jywge1xuICAgICAgICAgICAgdHlwZTogJ3JhZGlvJ1xuICAgICAgICB9KSAmJiBlbC5uYW1lKSB7XG4gICAgICAgICAgICAvLyBJZiB0aGUgYWN0aXZlIGVsZW1lbnQgaXMgcGFydCBvZiB0aGUgZ3JvdXAsIGFkZCBvbmx5IHRoYXRcbiAgICAgICAgICAgIGlmIChlbCA9PT0gYWN0aXZlRWxlbWVudCkge1xuICAgICAgICAgICAgICAgIHBydW5lZEVsZW1lbnRzLnB1c2goZWwpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZWwubmFtZSA9PT0gYWN0aXZlUmFkaW9Hcm91cCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIElmIHdlIHN0dW1ibGUgdXBvbiBhIGNoZWNrZWQgcmFkaW8sIHJlbW92ZSB0aGUgb3RoZXJzXG4gICAgICAgICAgICBpZiAoZWwuY2hlY2tlZCkge1xuICAgICAgICAgICAgICAgIHBydW5lZEVsZW1lbnRzID0gcHJ1bmVkRWxlbWVudHMuZmlsdGVyKChlKT0+IWlzRWxlbWVudFR5cGUuaXNFbGVtZW50VHlwZShlLCAnaW5wdXQnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAncmFkaW8nLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogZWwubmFtZVxuICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgcHJ1bmVkRWxlbWVudHMucHVzaChlbCk7XG4gICAgICAgICAgICAgICAgY2hlY2tlZFJhZGlvW2VsLm5hbWVdID0gZWw7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gSWYgd2UgYWxyZWFkeSBmb3VuZCB0aGUgY2hlY2tlZCBvbmUsIHNraXBcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY2hlY2tlZFJhZGlvW2VsLm5hbWVdICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBwcnVuZWRFbGVtZW50cy5wdXNoKGVsKTtcbiAgICB9KTtcbiAgICBmb3IobGV0IGluZGV4ID0gcHJ1bmVkRWxlbWVudHMuZmluZEluZGV4KChlbCk9PmVsID09PSBhY3RpdmVFbGVtZW50KTs7KXtcbiAgICAgICAgaW5kZXggKz0gc2hpZnQgPyAtMSA6IDE7XG4gICAgICAgIC8vIGxvb3AgYXQgb3ZlcmZsb3dcbiAgICAgICAgaWYgKGluZGV4ID09PSBwcnVuZWRFbGVtZW50cy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGluZGV4ID0gMDtcbiAgICAgICAgfSBlbHNlIGlmIChpbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAgIGluZGV4ID0gcHJ1bmVkRWxlbWVudHMubGVuZ3RoIC0gMTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocHJ1bmVkRWxlbWVudHNbaW5kZXhdID09PSBhY3RpdmVFbGVtZW50IHx8IHBydW5lZEVsZW1lbnRzW2luZGV4XSA9PT0gZG9jdW1lbnQuYm9keSB8fCBpc1Zpc2libGUuaXNWaXNpYmxlKHBydW5lZEVsZW1lbnRzW2luZGV4XSkpIHtcbiAgICAgICAgICAgIHJldHVybiBwcnVuZWRFbGVtZW50c1tpbmRleF07XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmV4cG9ydHMuZ2V0VGFiRGVzdGluYXRpb24gPSBnZXRUYWJEZXN0aW5hdGlvbjtcbiJdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWTs7QUFFWkEsTUFBTSxDQUFDQyxjQUFjLENBQUNDLE9BQU8sRUFBRSxZQUFZLEVBQUU7RUFBRUMsS0FBSyxFQUFFO0FBQUssQ0FBQyxDQUFDO0FBRTdELElBQUlDLFVBQVUsR0FBR0MsT0FBTyxDQUFDLHVCQUF1QixDQUFDO0FBQ2pELElBQUlDLGFBQWEsR0FBR0QsT0FBTyxDQUFDLDBCQUEwQixDQUFDO0FBQ3ZELElBQUlFLFNBQVMsR0FBR0YsT0FBTyxDQUFDLHNCQUFzQixDQUFDO0FBQy9DLElBQUlHLFFBQVEsR0FBR0gsT0FBTyxDQUFDLGVBQWUsQ0FBQztBQUV2QyxTQUFTSSxpQkFBaUJBLENBQUNDLGFBQWEsRUFBRUMsS0FBSyxFQUFFO0VBQzdDLE1BQU1DLFFBQVEsR0FBR0YsYUFBYSxDQUFDRyxhQUFhO0VBQzVDLE1BQU1DLGlCQUFpQixHQUFHRixRQUFRLENBQUNHLGdCQUFnQixDQUFDUCxRQUFRLENBQUNRLGtCQUFrQixDQUFDO0VBQ2hGLE1BQU1DLGVBQWUsR0FBR0MsS0FBSyxDQUFDQyxJQUFJLENBQUNMLGlCQUFpQixDQUFDLENBQUNNLE1BQU0sQ0FBRUMsRUFBRSxJQUFHQSxFQUFFLEtBQUtYLGFBQWEsSUFBSSxFQUFFWSxNQUFNLENBQUNELEVBQUUsQ0FBQ0UsWUFBWSxDQUFDLFVBQVUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJbkIsVUFB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