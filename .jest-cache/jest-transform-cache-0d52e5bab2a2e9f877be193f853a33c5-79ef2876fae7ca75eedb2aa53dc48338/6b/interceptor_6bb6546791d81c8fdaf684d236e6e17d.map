{"version":3,"names":["Object","defineProperty","exports","value","require","isElementType","trackValue","UI","Interceptor","Symbol","prepareInterceptor","element","propName","interceptorImpl","prototypeDescriptor","getOwnPropertyDescriptor","constructor","prototype","objectDescriptor","target","set","Error","tagName","String","intercept","args","applyNative","realArgs","then","call","realFunc","prepareValueInterceptor","v","isUI","isUIValue","startTrackValue","sanitizeValue","undefined","trackOrSetValue","type","Number","isNaN","prepareSelectionInterceptor","start","others","isUISelectionStart","setUISelectionClean","setUISelectionRaw","anchorOffset","focusOffset","getUIValue","length","prepareRangeTextInterceptor","setUIValueClean"],"sources":["interceptor.js"],"sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nrequire('../utils/click/isClickableInput.js');\nrequire('../utils/dataTransfer/Clipboard.js');\nrequire('../utils/edit/isEditable.js');\nrequire('../utils/edit/maxLength.js');\nvar isElementType = require('../utils/misc/isElementType.js');\nrequire('@testing-library/dom/dist/helpers.js');\nrequire('../utils/keyDef/readNextDescriptor.js');\nrequire('../utils/misc/level.js');\nrequire('../options.js');\nvar trackValue = require('./trackValue.js');\nvar UI = require('./UI.js');\n\nconst Interceptor = Symbol('Interceptor for programmatical calls');\nfunction prepareInterceptor(element, propName, interceptorImpl) {\n    const prototypeDescriptor = Object.getOwnPropertyDescriptor(element.constructor.prototype, propName);\n    const objectDescriptor = Object.getOwnPropertyDescriptor(element, propName);\n    const target = (prototypeDescriptor === null || prototypeDescriptor === void 0 ? void 0 : prototypeDescriptor.set) ? 'set' : 'value';\n    /* istanbul ignore if */ if (typeof (prototypeDescriptor === null || prototypeDescriptor === void 0 ? void 0 : prototypeDescriptor[target]) !== 'function' || prototypeDescriptor[target][Interceptor]) {\n        throw new Error(`Element ${element.tagName} does not implement \"${String(propName)}\".`);\n    }\n    function intercept(...args) {\n        const { applyNative = false, realArgs, then } = interceptorImpl.call(this, ...args);\n        const realFunc = (!applyNative && objectDescriptor || prototypeDescriptor)[target];\n        if (target === 'set') {\n            realFunc.call(this, realArgs);\n        } else {\n            realFunc.call(this, ...realArgs);\n        }\n        then === null || then === void 0 ? void 0 : then();\n    }\n    intercept[Interceptor] = Interceptor;\n    Object.defineProperty(element, propName, {\n        ...objectDescriptor !== null && objectDescriptor !== void 0 ? objectDescriptor : prototypeDescriptor,\n        [target]: intercept\n    });\n}\nfunction prepareValueInterceptor(element) {\n    prepareInterceptor(element, 'value', function interceptorImpl(v) {\n        const isUI = UI.isUIValue(v);\n        if (isUI) {\n            trackValue.startTrackValue(this);\n        }\n        return {\n            applyNative: !!isUI,\n            realArgs: sanitizeValue(this, v),\n            then: isUI ? undefined : ()=>trackValue.trackOrSetValue(this, String(v))\n        };\n    });\n}\nfunction sanitizeValue(element, v) {\n    // Workaround for JSDOM\n    if (isElementType.isElementType(element, 'input', {\n        type: 'number'\n    }) && String(v) !== '' && !Number.isNaN(Number(v))) {\n        // Setting value to \"1.\" results in `null` in JSDOM\n        return String(Number(v));\n    }\n    return String(v);\n}\nfunction prepareSelectionInterceptor(element) {\n    prepareInterceptor(element, 'setSelectionRange', function interceptorImpl(start, ...others) {\n        const isUI = UI.isUISelectionStart(start);\n        return {\n            applyNative: !!isUI,\n            realArgs: [\n                Number(start),\n                ...others\n            ],\n            then: ()=>isUI ? undefined : UI.setUISelectionClean(element)\n        };\n    });\n    prepareInterceptor(element, 'selectionStart', function interceptorImpl(v) {\n        return {\n            realArgs: v,\n            then: ()=>UI.setUISelectionClean(element)\n        };\n    });\n    prepareInterceptor(element, 'selectionEnd', function interceptorImpl(v) {\n        return {\n            realArgs: v,\n            then: ()=>UI.setUISelectionClean(element)\n        };\n    });\n    prepareInterceptor(element, 'select', function interceptorImpl() {\n        return {\n            realArgs: [],\n            then: ()=>UI.setUISelectionRaw(element, {\n                    anchorOffset: 0,\n                    focusOffset: UI.getUIValue(element).length\n                })\n        };\n    });\n}\nfunction prepareRangeTextInterceptor(element) {\n    prepareInterceptor(element, 'setRangeText', function interceptorImpl(...realArgs) {\n        return {\n            realArgs,\n            then: ()=>{\n                UI.setUIValueClean(element);\n                UI.setUISelectionClean(element);\n            }\n        };\n    });\n}\n\nexports.prepareInterceptor = prepareInterceptor;\nexports.prepareRangeTextInterceptor = prepareRangeTextInterceptor;\nexports.prepareSelectionInterceptor = prepareSelectionInterceptor;\nexports.prepareValueInterceptor = prepareValueInterceptor;\n"],"mappings":"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"}