578d256548d1bfc501cc7d5992e7f63f
'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});
require('../utils/click/isClickableInput.js');
var FileList = require('../utils/dataTransfer/FileList.js');
require('../utils/dataTransfer/Clipboard.js');
require('../utils/edit/isEditable.js');
require('../utils/edit/maxLength.js');
var setFiles = require('../utils/edit/setFiles.js');
var isElementType = require('../utils/misc/isElementType.js');
var isDisabled = require('../utils/misc/isDisabled.js');
var getWindow = require('../utils/misc/getWindow.js');
require('../utils/keyDef/readNextDescriptor.js');
require('../utils/misc/level.js');
require('../options.js');
async function upload(element, fileOrFiles) {
  const input = isElementType.isElementType(element, 'label') ? element.control : element;
  if (!input || !isElementType.isElementType(input, 'input', {
    type: 'file'
  })) {
    throw new TypeError(`The ${input === element ? 'given' : 'associated'} ${input === null || input === void 0 ? void 0 : input.tagName} element does not accept file uploads`);
  }
  if (isDisabled.isDisabled(element)) return;
  const files = (Array.isArray(fileOrFiles) ? fileOrFiles : [fileOrFiles]).filter(file => !this.config.applyAccept || isAcceptableFile(file, input.accept)).slice(0, input.multiple ? undefined : 1);
  const fileDialog = () => {
    var _input_files;
    // do not fire an input event if the file selection does not change
    if (files.length === ((_input_files = input.files) === null || _input_files === void 0 ? void 0 : _input_files.length) && files.every((f, i) => {
      var _input_files;
      return f === ((_input_files = input.files) === null || _input_files === void 0 ? void 0 : _input_files.item(i));
    })) {
      return;
    }
    setFiles.setFiles(input, FileList.createFileList(getWindow.getWindow(element), files));
    this.dispatchUIEvent(input, 'input');
    this.dispatchUIEvent(input, 'change');
  };
  input.addEventListener('fileDialog', fileDialog);
  await this.click(element);
  input.removeEventListener('fileDialog', fileDialog);
}
function isAcceptableFile(file, accept) {
  if (!accept) {
    return true;
  }
  const wildcards = ['audio/*', 'image/*', 'video/*'];
  return accept.split(',').some(acceptToken => {
    if (acceptToken.startsWith('.')) {
      // tokens starting with a dot represent a file extension
      return file.name.endsWith(acceptToken);
    } else if (wildcards.includes(acceptToken)) {
      return file.type.startsWith(acceptToken.substr(0, acceptToken.length - 1));
    }
    return file.type === acceptToken;
  });
}
exports.upload = upload;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsInJlcXVpcmUiLCJGaWxlTGlzdCIsInNldEZpbGVzIiwiaXNFbGVtZW50VHlwZSIsImlzRGlzYWJsZWQiLCJnZXRXaW5kb3ciLCJ1cGxvYWQiLCJlbGVtZW50IiwiZmlsZU9yRmlsZXMiLCJpbnB1dCIsImNvbnRyb2wiLCJ0eXBlIiwiVHlwZUVycm9yIiwidGFnTmFtZSIsImZpbGVzIiwiQXJyYXkiLCJpc0FycmF5IiwiZmlsdGVyIiwiZmlsZSIsImNvbmZpZyIsImFwcGx5QWNjZXB0IiwiaXNBY2NlcHRhYmxlRmlsZSIsImFjY2VwdCIsInNsaWNlIiwibXVsdGlwbGUiLCJ1bmRlZmluZWQiLCJmaWxlRGlhbG9nIiwiX2lucHV0X2ZpbGVzIiwibGVuZ3RoIiwiZXZlcnkiLCJmIiwiaSIsIml0ZW0iLCJjcmVhdGVGaWxlTGlzdCIsImRpc3BhdGNoVUlFdmVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJjbGljayIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJ3aWxkY2FyZHMiLCJzcGxpdCIsInNvbWUiLCJhY2NlcHRUb2tlbiIsInN0YXJ0c1dpdGgiLCJuYW1lIiwiZW5kc1dpdGgiLCJpbmNsdWRlcyIsInN1YnN0ciJdLCJzb3VyY2VzIjpbInVwbG9hZC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG5cbnJlcXVpcmUoJy4uL3V0aWxzL2NsaWNrL2lzQ2xpY2thYmxlSW5wdXQuanMnKTtcbnZhciBGaWxlTGlzdCA9IHJlcXVpcmUoJy4uL3V0aWxzL2RhdGFUcmFuc2Zlci9GaWxlTGlzdC5qcycpO1xucmVxdWlyZSgnLi4vdXRpbHMvZGF0YVRyYW5zZmVyL0NsaXBib2FyZC5qcycpO1xucmVxdWlyZSgnLi4vdXRpbHMvZWRpdC9pc0VkaXRhYmxlLmpzJyk7XG5yZXF1aXJlKCcuLi91dGlscy9lZGl0L21heExlbmd0aC5qcycpO1xudmFyIHNldEZpbGVzID0gcmVxdWlyZSgnLi4vdXRpbHMvZWRpdC9zZXRGaWxlcy5qcycpO1xudmFyIGlzRWxlbWVudFR5cGUgPSByZXF1aXJlKCcuLi91dGlscy9taXNjL2lzRWxlbWVudFR5cGUuanMnKTtcbnZhciBpc0Rpc2FibGVkID0gcmVxdWlyZSgnLi4vdXRpbHMvbWlzYy9pc0Rpc2FibGVkLmpzJyk7XG52YXIgZ2V0V2luZG93ID0gcmVxdWlyZSgnLi4vdXRpbHMvbWlzYy9nZXRXaW5kb3cuanMnKTtcbnJlcXVpcmUoJy4uL3V0aWxzL2tleURlZi9yZWFkTmV4dERlc2NyaXB0b3IuanMnKTtcbnJlcXVpcmUoJy4uL3V0aWxzL21pc2MvbGV2ZWwuanMnKTtcbnJlcXVpcmUoJy4uL29wdGlvbnMuanMnKTtcblxuYXN5bmMgZnVuY3Rpb24gdXBsb2FkKGVsZW1lbnQsIGZpbGVPckZpbGVzKSB7XG4gICAgY29uc3QgaW5wdXQgPSBpc0VsZW1lbnRUeXBlLmlzRWxlbWVudFR5cGUoZWxlbWVudCwgJ2xhYmVsJykgPyBlbGVtZW50LmNvbnRyb2wgOiBlbGVtZW50O1xuICAgIGlmICghaW5wdXQgfHwgIWlzRWxlbWVudFR5cGUuaXNFbGVtZW50VHlwZShpbnB1dCwgJ2lucHV0Jywge1xuICAgICAgICB0eXBlOiAnZmlsZSdcbiAgICB9KSkge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKGBUaGUgJHtpbnB1dCA9PT0gZWxlbWVudCA/ICdnaXZlbicgOiAnYXNzb2NpYXRlZCd9ICR7aW5wdXQgPT09IG51bGwgfHwgaW5wdXQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGlucHV0LnRhZ05hbWV9IGVsZW1lbnQgZG9lcyBub3QgYWNjZXB0IGZpbGUgdXBsb2Fkc2ApO1xuICAgIH1cbiAgICBpZiAoaXNEaXNhYmxlZC5pc0Rpc2FibGVkKGVsZW1lbnQpKSByZXR1cm47XG4gICAgY29uc3QgZmlsZXMgPSAoQXJyYXkuaXNBcnJheShmaWxlT3JGaWxlcykgPyBmaWxlT3JGaWxlcyA6IFtcbiAgICAgICAgZmlsZU9yRmlsZXNcbiAgICBdKS5maWx0ZXIoKGZpbGUpPT4hdGhpcy5jb25maWcuYXBwbHlBY2NlcHQgfHwgaXNBY2NlcHRhYmxlRmlsZShmaWxlLCBpbnB1dC5hY2NlcHQpKS5zbGljZSgwLCBpbnB1dC5tdWx0aXBsZSA/IHVuZGVmaW5lZCA6IDEpO1xuICAgIGNvbnN0IGZpbGVEaWFsb2cgPSAoKT0+e1xuICAgICAgICB2YXIgX2lucHV0X2ZpbGVzO1xuICAgICAgICAvLyBkbyBub3QgZmlyZSBhbiBpbnB1dCBldmVudCBpZiB0aGUgZmlsZSBzZWxlY3Rpb24gZG9lcyBub3QgY2hhbmdlXG4gICAgICAgIGlmIChmaWxlcy5sZW5ndGggPT09ICgoX2lucHV0X2ZpbGVzID0gaW5wdXQuZmlsZXMpID09PSBudWxsIHx8IF9pbnB1dF9maWxlcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2lucHV0X2ZpbGVzLmxlbmd0aCkgJiYgZmlsZXMuZXZlcnkoKGYsIGkpPT57XG4gICAgICAgICAgICB2YXIgX2lucHV0X2ZpbGVzO1xuICAgICAgICAgICAgcmV0dXJuIGYgPT09ICgoX2lucHV0X2ZpbGVzID0gaW5wdXQuZmlsZXMpID09PSBudWxsIHx8IF9pbnB1dF9maWxlcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2lucHV0X2ZpbGVzLml0ZW0oaSkpO1xuICAgICAgICB9KSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHNldEZpbGVzLnNldEZpbGVzKGlucHV0LCBGaWxlTGlzdC5jcmVhdGVGaWxlTGlzdChnZXRXaW5kb3cuZ2V0V2luZG93KGVsZW1lbnQpLCBmaWxlcykpO1xuICAgICAgICB0aGlzLmRpc3BhdGNoVUlFdmVudChpbnB1dCwgJ2lucHV0Jyk7XG4gICAgICAgIHRoaXMuZGlzcGF0Y2hVSUV2ZW50KGlucHV0LCAnY2hhbmdlJyk7XG4gICAgfTtcbiAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdmaWxlRGlhbG9nJywgZmlsZURpYWxvZyk7XG4gICAgYXdhaXQgdGhpcy5jbGljayhlbGVtZW50KTtcbiAgICBpbnB1dC5yZW1vdmVFdmVudExpc3RlbmVyKCdmaWxlRGlhbG9nJywgZmlsZURpYWxvZyk7XG59XG5mdW5jdGlvbiBpc0FjY2VwdGFibGVGaWxlKGZpbGUsIGFjY2VwdCkge1xuICAgIGlmICghYWNjZXB0KSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBjb25zdCB3aWxkY2FyZHMgPSBbXG4gICAgICAgICdhdWRpby8qJyxcbiAgICAgICAgJ2ltYWdlLyonLFxuICAgICAgICAndmlkZW8vKidcbiAgICBdO1xuICAgIHJldHVybiBhY2NlcHQuc3BsaXQoJywnKS5zb21lKChhY2NlcHRUb2tlbik9PntcbiAgICAgICAgaWYgKGFjY2VwdFRva2VuLnN0YXJ0c1dpdGgoJy4nKSkge1xuICAgICAgICAgICAgLy8gdG9rZW5zIHN0YXJ0aW5nIHdpdGggYSBkb3QgcmVwcmVzZW50IGEgZmlsZSBleHRlbnNpb25cbiAgICAgICAgICAgIHJldHVybiBmaWxlLm5hbWUuZW5kc1dpdGgoYWNjZXB0VG9rZW4pO1xuICAgICAgICB9IGVsc2UgaWYgKHdpbGRjYXJkcy5pbmNsdWRlcyhhY2NlcHRUb2tlbikpIHtcbiAgICAgICAgICAgIHJldHVybiBmaWxlLnR5cGUuc3RhcnRzV2l0aChhY2NlcHRUb2tlbi5zdWJzdHIoMCwgYWNjZXB0VG9rZW4ubGVuZ3RoIC0gMSkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmaWxlLnR5cGUgPT09IGFjY2VwdFRva2VuO1xuICAgIH0pO1xufVxuXG5leHBvcnRzLnVwbG9hZCA9IHVwbG9hZDtcbiJdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWTs7QUFFWkEsTUFBTSxDQUFDQyxjQUFjLENBQUNDLE9BQU8sRUFBRSxZQUFZLEVBQUU7RUFBRUMsS0FBSyxFQUFFO0FBQUssQ0FBQyxDQUFDO0FBRTdEQyxPQUFPLENBQUMsb0NBQW9DLENB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