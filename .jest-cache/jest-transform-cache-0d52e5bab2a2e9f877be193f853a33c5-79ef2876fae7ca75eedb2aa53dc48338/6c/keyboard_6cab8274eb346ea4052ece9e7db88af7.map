{"version":3,"names":["Object","defineProperty","exports","value","require","getActiveElement","_define_property","obj","key","enumerable","configurable","writable","DOM_KEY_LOCATION","modifierKeys","isModifierKey","includes","modifierLocks","isModifierLock","KeyboardHost","isKeyPressed","keyDef","pressed","String","code","getPressedKeys","values","map","p","keydown","instance","_this_pressed","_code","_this_pressed_code","target","getActiveElementOrBody","config","document","setKeydownTarget","_","unpreventedDefault","modifiers","unprevented","dispatchUIEvent","modifierLockStart","hasKeyPress","charCode","charCodeAt","keyup","find","lastKeydownTarget","carryChar","length","Control","Alt","constructor","system","AltGraph","CapsLock","Fn","FnLock","Meta","NumLock","ScrollLock","Shift","Symbol","SymbolLock","undefined"],"sources":["keyboard.js"],"sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nrequire('../utils/click/isClickableInput.js');\nrequire('../utils/dataTransfer/Clipboard.js');\nrequire('../utils/edit/isEditable.js');\nrequire('../utils/edit/maxLength.js');\nvar getActiveElement = require('../utils/focus/getActiveElement.js');\nrequire('@testing-library/dom/dist/helpers.js');\nrequire('../utils/keyDef/readNextDescriptor.js');\nrequire('../utils/misc/level.js');\nrequire('../options.js');\n\nfunction _define_property(obj, key, value) {\n    if (key in obj) {\n        Object.defineProperty(obj, key, {\n            value: value,\n            enumerable: true,\n            configurable: true,\n            writable: true\n        });\n    } else {\n        obj[key] = value;\n    }\n    return obj;\n}\nexports.DOM_KEY_LOCATION = void 0;\n(function(DOM_KEY_LOCATION) {\n    DOM_KEY_LOCATION[DOM_KEY_LOCATION[\"STANDARD\"] = 0] = \"STANDARD\";\n    DOM_KEY_LOCATION[DOM_KEY_LOCATION[\"LEFT\"] = 1] = \"LEFT\";\n    DOM_KEY_LOCATION[DOM_KEY_LOCATION[\"RIGHT\"] = 2] = \"RIGHT\";\n    DOM_KEY_LOCATION[DOM_KEY_LOCATION[\"NUMPAD\"] = 3] = \"NUMPAD\";\n})(exports.DOM_KEY_LOCATION || (exports.DOM_KEY_LOCATION = {}));\nconst modifierKeys = [\n    'Alt',\n    'AltGraph',\n    'Control',\n    'Fn',\n    'Meta',\n    'Shift',\n    'Symbol'\n];\nfunction isModifierKey(key) {\n    return modifierKeys.includes(key);\n}\nconst modifierLocks = [\n    'CapsLock',\n    'FnLock',\n    'NumLock',\n    'ScrollLock',\n    'SymbolLock'\n];\nfunction isModifierLock(key) {\n    return modifierLocks.includes(key);\n}\nclass KeyboardHost {\n    isKeyPressed(keyDef) {\n        return !!this.pressed[String(keyDef.code)];\n    }\n    getPressedKeys() {\n        return Object.values(this.pressed).map((p)=>p.keyDef);\n    }\n    /** Press a key */ async keydown(instance, keyDef) {\n        var // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n        _this_pressed, _code, _this_pressed_code;\n        const key = String(keyDef.key);\n        const code = String(keyDef.code);\n        const target = getActiveElement.getActiveElementOrBody(instance.config.document);\n        this.setKeydownTarget(target);\n        var _;\n        (_ = (_this_pressed = this.pressed)[_code = code]) !== null && _ !== void 0 ? _ : _this_pressed[_code] = {\n            keyDef,\n            unpreventedDefault: false\n        };\n        if (isModifierKey(key)) {\n            this.modifiers[key] = true;\n        }\n        const unprevented = instance.dispatchUIEvent(target, 'keydown', {\n            key,\n            code\n        });\n        if (isModifierLock(key) && !this.modifiers[key]) {\n            this.modifiers[key] = true;\n            this.modifierLockStart[key] = true;\n        }\n        (_this_pressed_code = this.pressed[code]).unpreventedDefault || (_this_pressed_code.unpreventedDefault = unprevented);\n        if (unprevented && this.hasKeyPress(key)) {\n            instance.dispatchUIEvent(getActiveElement.getActiveElementOrBody(instance.config.document), 'keypress', {\n                key,\n                code,\n                charCode: keyDef.key === 'Enter' ? 13 : String(keyDef.key).charCodeAt(0)\n            });\n        }\n    }\n    /** Release a key */ async keyup(instance, keyDef) {\n        const key = String(keyDef.key);\n        const code = String(keyDef.code);\n        const unprevented = this.pressed[code].unpreventedDefault;\n        // eslint-disable-next-line @typescript-eslint/no-dynamic-delete\n        delete this.pressed[code];\n        if (isModifierKey(key) && !Object.values(this.pressed).find((p)=>p.keyDef.key === key)) {\n            this.modifiers[key] = false;\n        }\n        instance.dispatchUIEvent(getActiveElement.getActiveElementOrBody(instance.config.document), 'keyup', {\n            key,\n            code\n        }, !unprevented);\n        if (isModifierLock(key) && this.modifiers[key]) {\n            if (this.modifierLockStart[key]) {\n                this.modifierLockStart[key] = false;\n            } else {\n                this.modifiers[key] = false;\n            }\n        }\n    }\n    setKeydownTarget(target) {\n        if (target !== this.lastKeydownTarget) {\n            this.carryChar = '';\n        }\n        this.lastKeydownTarget = target;\n    }\n    hasKeyPress(key) {\n        return (key.length === 1 || key === 'Enter') && !this.modifiers.Control && !this.modifiers.Alt;\n    }\n    constructor(system){\n        _define_property(this, \"system\", void 0);\n        _define_property(this, \"modifiers\", {\n            Alt: false,\n            AltGraph: false,\n            CapsLock: false,\n            Control: false,\n            Fn: false,\n            FnLock: false,\n            Meta: false,\n            NumLock: false,\n            ScrollLock: false,\n            Shift: false,\n            Symbol: false,\n            SymbolLock: false\n        });\n        _define_property(this, \"pressed\", {});\n        _define_property(this, \"carryChar\", '');\n        _define_property(this, \"lastKeydownTarget\", undefined);\n        _define_property(this, \"modifierLockStart\", {});\n        this.system = system;\n    }\n}\n\nexports.KeyboardHost = KeyboardHost;\n"],"mappings":"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"}