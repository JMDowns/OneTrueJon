{"version":3,"names":["Object","defineProperty","exports","value","UI","require","selection","resolveCaretPosition","target","node","offset","hasOwnSelection","getUIValue","length","nodeType","nodeValue","childNodes","findNodeAtTextOffset","isRoot","i","undefined","step","Math","max","Error","c","item","text","String","textContent"],"sources":["resolveCaretPosition.js"],"sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar UI = require('../../document/UI.js');\nrequire('../../utils/click/isClickableInput.js');\nrequire('../../utils/dataTransfer/Clipboard.js');\nrequire('../../utils/edit/isEditable.js');\nrequire('../../utils/edit/maxLength.js');\nrequire('@testing-library/dom/dist/helpers.js');\nvar selection = require('../../utils/focus/selection.js');\nrequire('../../utils/keyDef/readNextDescriptor.js');\nrequire('../../utils/misc/level.js');\nrequire('../../options.js');\n\nfunction resolveCaretPosition({ target, node, offset }) {\n    if (selection.hasOwnSelection(target)) {\n        return {\n            node: target,\n            offset: offset !== null && offset !== void 0 ? offset : UI.getUIValue(target).length\n        };\n    } else if (node) {\n        return {\n            node,\n            offset: offset !== null && offset !== void 0 ? offset : node.nodeType === 3 ? node.nodeValue.length : node.childNodes.length\n        };\n    }\n    return findNodeAtTextOffset(target, offset);\n}\nfunction findNodeAtTextOffset(node, offset, isRoot = true) {\n    // When clicking after the content the browser behavior can be complicated:\n    // 1. If there is textContent after the last element child,\n    // the cursor is moved there.\n    // 2. If there is textContent in the last element child,\n    // the browser moves the cursor to the last non-empty text node inside this element.\n    // 3. Otherwise the cursor is moved to the end of the target.\n    let i = offset === undefined ? node.childNodes.length - 1 : 0;\n    const step = offset === undefined ? -1 : +1;\n    while(offset === undefined ? i >= (isRoot ? Math.max(node.childNodes.length - 1, 0) : 0) : i <= node.childNodes.length){\n        if (offset && i === node.childNodes.length) {\n            throw new Error('The given offset is out of bounds.');\n        }\n        const c = node.childNodes.item(i);\n        const text = String(c.textContent);\n        if (text.length) {\n            if (offset !== undefined && text.length < offset) {\n                offset -= text.length;\n            } else if (c.nodeType === 1) {\n                return findNodeAtTextOffset(c, offset, false);\n            } else {\n                // The pre-commit hooks keeps changing this\n                // See https://github.com/kentcdodds/kcd-scripts/issues/218\n                /* istanbul ignore else */ // eslint-disable-next-line no-lonely-if\n                if (c.nodeType === 3) {\n                    return {\n                        node: c,\n                        offset: offset !== null && offset !== void 0 ? offset : c.nodeValue.length\n                    };\n                }\n            }\n        }\n        i += step;\n    }\n    return {\n        node,\n        offset: node.childNodes.length\n    };\n}\n\nexports.resolveCaretPosition = resolveCaretPosition;\n"],"mappings":"AAAA,YAAY;;AAEZA,MAAM,CAACC,cAAc,CAACC,OAAO,EAAE,YAAY,EAAE;EAAEC,KAAK,EAAE;AAAK,CAAC,CAAC;AAE7D,IAAIC,EAAE,GAAGC,OAAO,CAAC,sBAAsB,CAAC;AACxCA,OAAO,CAAC,uCAAuC,CAAC;AAChDA,OAAO,CAAC,uCAAuC,CAAC;AAChDA,OAAO,CAAC,gCAAgC,CAAC;AACzCA,OAAO,CAAC,+BAA+B,CAAC;AACxCA,OAAO,CAAC,sCAAsC,CAAC;AAC/C,IAAIC,SAAS,GAAGD,OAAO,CAAC,gCAAgC,CAAC;AACzDA,OAAO,CAAC,0CAA0C,CAAC;AACnDA,OAAO,CAAC,2BAA2B,CAAC;AACpCA,OAAO,CAAC,kBAAkB,CAAC;AAE3B,SAASE,oBAAoBA,CAAC;EAAEC,MAAM;EAAEC,IAAI;EAAEC;AAAO,CAAC,EAAE;EACpD,IAAIJ,SAAS,CAACK,eAAe,CAACH,MAAM,CAAC,EAAE;IACnC,OAAO;MACHC,IAAI,EAAED,MAAM;MACZE,MAAM,EAAEA,MAAM,KAAK,IAAI,IAAIA,MAAM,KAAK,KAAK,CAAC,GAAGA,MAAM,GAAGN,EAAE,CAACQ,UAAU,CAACJ,MAAM,CAAC,CAACK;IAClF,CAAC;EACL,CAAC,MAAM,IAAIJ,IAAI,EAAE;IACb,OAAO;MACHA,IAAI;MACJC,MAAM,EAAEA,MAAM,KAAK,IAAI,IAAIA,MAAM,KAAK,KAAK,CAAC,GAAGA,MAAM,GAAGD,IAAI,CAACK,QAAQ,KAAK,CAAC,GAAGL,IAAI,CAACM,SAAS,CAACF,MAAM,GAAGJ,IAAI,CAACO,UAAU,CAACH;IAC1H,CAAC;EACL;EACA,OAAOI,oBAAoB,CAACT,MAAM,EAAEE,MAAM,CAAC;AAC/C;AACA,SAASO,oBAAoBA,CAACR,IAAI,EAAEC,MAAM,EAAEQ,MAAM,GAAG,IAAI,EAAE;EACvD;EACA;EACA;EACA;EACA;EACA;EACA,IAAIC,CAAC,GAAGT,MAAM,KAAKU,SAAS,GAAGX,IAAI,CAACO,UAAU,CAACH,MAAM,GAAG,CAAC,GAAG,CAAC;EAC7D,MAAMQ,IAAI,GAAGX,MAAM,KAAKU,SAAS,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC;EAC3C,OAAMV,MAAM,KAAKU,SAAS,GAAGD,CAAC,KAAKD,MAAM,GAAGI,IAAI,CAACC,GAAG,CAACd,IAAI,CAACO,UAAU,CAACH,MAAM,GAAG,CAAC,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,GAAGM,CAAC,IAAIV,IAAI,CAACO,UAAU,CAACH,MAAM,EAAC;IACnH,IAAIH,MAAM,IAAIS,CAAC,KAAKV,IAAI,CAACO,UAAU,CAACH,MAAM,EAAE;MACxC,MAAM,IAAIW,KAAK,CAAC,oCAAoC,CAAC;IACzD;IACA,MAAMC,CAAC,GAAGhB,IAAI,CAACO,UAAU,CAACU,IAAI,CAACP,CAAC,CAAC;IACjC,MAAMQ,IAAI,GAAGC,MAAM,CAACH,CAAC,CAACI,WAAW,CAAC;IAClC,IAAIF,IAAI,CAACd,MAAM,EAAE;MACb,IAAIH,MAAM,KAAKU,SAAS,IAAIO,IAAI,CAACd,MAAM,GAAGH,MAAM,EAAE;QAC9CA,MAAM,IAAIiB,IAAI,CAACd,MAAM;MACzB,CAAC,MAAM,IAAIY,CAAC,CAACX,QAAQ,KAAK,CAAC,EAAE;QACzB,OAAOG,oBAAoB,CAACQ,CAAC,EAAEf,MAAM,EAAE,KAAK,CAAC;MACjD,CAAC,MAAM;QACH;QACA;QACA,2BAA2B;QAC3B,IAAIe,CAAC,CAACX,QAAQ,KAAK,CAAC,EAAE;UAClB,OAAO;YACHL,IAAI,EAAEgB,CAAC;YACPf,MAAM,EAAEA,MAAM,KAAK,IAAI,IAAIA,MAAM,KAAK,KAAK,CAAC,GAAGA,MAAM,GAAGe,CAAC,CAACV,SAAS,CAACF;UACxE,CAAC;QACL;MACJ;IACJ;IACAM,CAAC,IAAIE,IAAI;EACb;EACA,OAAO;IACHZ,IAAI;IACJC,MAAM,EAAED,IAAI,CAACO,UAAU,CAACH;EAC5B,CAAC;AACL;AAEAX,OAAO,CAACK,oBAAoB,GAAGA,oBAAoB"}