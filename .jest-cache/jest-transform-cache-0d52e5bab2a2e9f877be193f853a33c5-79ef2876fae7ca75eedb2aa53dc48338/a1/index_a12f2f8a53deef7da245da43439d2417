b1fa0e4425b7c99f21c82f2fe5bbd200
'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});
exports.default = exports.TestEnvironment = void 0;
function _jsdom() {
  const data = require('jsdom');
  _jsdom = function () {
    return data;
  };
  return data;
}
function _fakeTimers() {
  const data = require('@jest/fake-timers');
  _fakeTimers = function () {
    return data;
  };
  return data;
}
function _jestMock() {
  const data = require('jest-mock');
  _jestMock = function () {
    return data;
  };
  return data;
}
function _jestUtil() {
  const data = require('jest-util');
  _jestUtil = function () {
    return data;
  };
  return data;
}
/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */

// The `Window` interface does not have an `Error.stackTraceLimit` property, but
// `JSDOMEnvironment` assumes it is there.
function isString(value) {
  return typeof value === 'string';
}
class JSDOMEnvironment {
  dom;
  fakeTimers;
  fakeTimersModern;
  global;
  errorEventListener;
  moduleMocker;
  customExportConditions = ['browser'];
  _configuredExportConditions;
  constructor(config, context) {
    const {
      projectConfig
    } = config;
    const virtualConsole = new (_jsdom().VirtualConsole)();
    virtualConsole.sendTo(context.console, {
      omitJSDOMErrors: true
    });
    virtualConsole.on('jsdomError', error => {
      context.console.error(error);
    });
    this.dom = new (_jsdom().JSDOM)(typeof projectConfig.testEnvironmentOptions.html === 'string' ? projectConfig.testEnvironmentOptions.html : '<!DOCTYPE html>', {
      pretendToBeVisual: true,
      resources: typeof projectConfig.testEnvironmentOptions.userAgent === 'string' ? new (_jsdom().ResourceLoader)({
        userAgent: projectConfig.testEnvironmentOptions.userAgent
      }) : undefined,
      runScripts: 'dangerously',
      url: 'http://localhost/',
      virtualConsole,
      ...projectConfig.testEnvironmentOptions
    });
    const global = this.global = this.dom.window;
    if (global == null) {
      throw new Error('JSDOM did not return a Window object');
    }

    // @ts-expect-error - for "universal" code (code should use `globalThis`)
    global.global = global;

    // Node's error-message stack size is limited at 10, but it's pretty useful
    // to see more than that when a test fails.
    this.global.Error.stackTraceLimit = 100;
    (0, _jestUtil().installCommonGlobals)(global, projectConfig.globals);

    // TODO: remove this ASAP, but it currently causes tests to run really slow
    global.Buffer = Buffer;

    // Report uncaught errors.
    this.errorEventListener = event => {
      if (userErrorListenerCount === 0 && event.error != null) {
        process.emit('uncaughtException', event.error);
      }
    };
    global.addEventListener('error', this.errorEventListener);

    // However, don't report them as uncaught if the user listens to 'error' event.
    // In that case, we assume the might have custom error handling logic.
    const originalAddListener = global.addEventListener.bind(global);
    const originalRemoveListener = global.removeEventListener.bind(global);
    let userErrorListenerCount = 0;
    global.addEventListener = function (...args) {
      if (args[0] === 'error') {
        userErrorListenerCount++;
      }
      return originalAddListener.apply(this, args);
    };
    global.removeEventListener = function (...args) {
      if (args[0] === 'error') {
        userErrorListenerCount--;
      }
      return originalRemoveListener.apply(this, args);
    };
    if ('customExportConditions' in projectConfig.testEnvironmentOptions) {
      const {
        customExportConditions
      } = projectConfig.testEnvironmentOptions;
      if (Array.isArray(customExportConditions) && customExportConditions.every(isString)) {
        this._configuredExportConditions = customExportConditions;
      } else {
        throw new Error('Custom export conditions specified but they are not an array of strings');
      }
    }
    this.moduleMocker = new (_jestMock().ModuleMocker)(global);
    this.fakeTimers = new (_fakeTimers().LegacyFakeTimers)({
      config: projectConfig,
      global: global,
      moduleMocker: this.moduleMocker,
      timerConfig: {
        idToRef: id => id,
        refToId: ref => ref
      }
    });
    this.fakeTimersModern = new (_fakeTimers().ModernFakeTimers)({
      config: projectConfig,
      global: global
    });
  }

  // eslint-disable-next-line @typescript-eslint/no-empty-function
  async setup() {}
  async teardown() {
    if (this.fakeTimers) {
      this.fakeTimers.dispose();
    }
    if (this.fakeTimersModern) {
      this.fakeTimersModern.dispose();
    }
    if (this.global != null) {
      if (this.errorEventListener) {
        this.global.removeEventListener('error', this.errorEventListener);
      }
      this.global.close();
    }
    this.errorEventListener = null;
    // @ts-expect-error: this.global not allowed to be `null`
    this.global = null;
    this.dom = null;
    this.fakeTimers = null;
    this.fakeTimersModern = null;
  }
  exportConditions() {
    return this._configuredExportConditions ?? this.customExportConditions;
  }
  getVmContext() {
    if (this.dom) {
      return this.dom.getInternalVMContext();
    }
    return null;
  }
}
exports.default = JSDOMEnvironment;
const TestEnvironment = JSDOMEnvironment;
exports.TestEnvironment = TestEnvironment;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsImRlZmF1bHQiLCJUZXN0RW52aXJvbm1lbnQiLCJfanNkb20iLCJkYXRhIiwicmVxdWlyZSIsIl9mYWtlVGltZXJzIiwiX2plc3RNb2NrIiwiX2plc3RVdGlsIiwiaXNTdHJpbmciLCJKU0RPTUVudmlyb25tZW50IiwiZG9tIiwiZmFrZVRpbWVycyIsImZha2VUaW1lcnNNb2Rlcm4iLCJnbG9iYWwiLCJlcnJvckV2ZW50TGlzdGVuZXIiLCJtb2R1bGVNb2NrZXIiLCJjdXN0b21FeHBvcnRDb25kaXRpb25zIiwiX2NvbmZpZ3VyZWRFeHBvcnRDb25kaXRpb25zIiwiY29uc3RydWN0b3IiLCJjb25maWciLCJjb250ZXh0IiwicHJvamVjdENvbmZpZyIsInZpcnR1YWxDb25zb2xlIiwiVmlydHVhbENvbnNvbGUiLCJzZW5kVG8iLCJjb25zb2xlIiwib21pdEpTRE9NRXJyb3JzIiwib24iLCJlcnJvciIsIkpTRE9NIiwidGVzdEVudmlyb25tZW50T3B0aW9ucyIsImh0bWwiLCJwcmV0ZW5kVG9CZVZpc3VhbCIsInJlc291cmNlcyIsInVzZXJBZ2VudCIsIlJlc291cmNlTG9hZGVyIiwidW5kZWZpbmVkIiwicnVuU2NyaXB0cyIsInVybCIsIndpbmRvdyIsIkVycm9yIiwic3RhY2tUcmFjZUxpbWl0IiwiaW5zdGFsbENvbW1vbkdsb2JhbHMiLCJnbG9iYWxzIiwiQnVmZmVyIiwiZXZlbnQiLCJ1c2VyRXJyb3JMaXN0ZW5lckNvdW50IiwicHJvY2VzcyIsImVtaXQiLCJhZGRFdmVudExpc3RlbmVyIiwib3JpZ2luYWxBZGRMaXN0ZW5lciIsImJpbmQiLCJvcmlnaW5hbFJlbW92ZUxpc3RlbmVyIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImFyZ3MiLCJhcHBseSIsIkFycmF5IiwiaXNBcnJheSIsImV2ZXJ5IiwiTW9kdWxlTW9ja2VyIiwiTGVnYWN5RmFrZVRpbWVycyIsInRpbWVyQ29uZmlnIiwiaWRUb1JlZiIsImlkIiwicmVmVG9JZCIsInJlZiIsIk1vZGVybkZha2VUaW1lcnMiLCJzZXR1cCIsInRlYXJkb3duIiwiZGlzcG9zZSIsImNsb3NlIiwiZXhwb3J0Q29uZGl0aW9ucyIsImdldFZtQ29udGV4dCIsImdldEludGVybmFsVk1Db250ZXh0Il0sInNvdXJjZXMiOlsiaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuZGVmYXVsdCA9IGV4cG9ydHMuVGVzdEVudmlyb25tZW50ID0gdm9pZCAwO1xuZnVuY3Rpb24gX2pzZG9tKCkge1xuICBjb25zdCBkYXRhID0gcmVxdWlyZSgnanNkb20nKTtcbiAgX2pzZG9tID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBkYXRhO1xuICB9O1xuICByZXR1cm4gZGF0YTtcbn1cbmZ1bmN0aW9uIF9mYWtlVGltZXJzKCkge1xuICBjb25zdCBkYXRhID0gcmVxdWlyZSgnQGplc3QvZmFrZS10aW1lcnMnKTtcbiAgX2Zha2VUaW1lcnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGRhdGE7XG4gIH07XG4gIHJldHVybiBkYXRhO1xufVxuZnVuY3Rpb24gX2plc3RNb2NrKCkge1xuICBjb25zdCBkYXRhID0gcmVxdWlyZSgnamVzdC1tb2NrJyk7XG4gIF9qZXN0TW9jayA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZGF0YTtcbiAgfTtcbiAgcmV0dXJuIGRhdGE7XG59XG5mdW5jdGlvbiBfamVzdFV0aWwoKSB7XG4gIGNvbnN0IGRhdGEgPSByZXF1aXJlKCdqZXN0LXV0aWwnKTtcbiAgX2plc3RVdGlsID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBkYXRhO1xuICB9O1xuICByZXR1cm4gZGF0YTtcbn1cbi8qKlxuICogQ29weXJpZ2h0IChjKSBNZXRhIFBsYXRmb3JtcywgSW5jLiBhbmQgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqL1xuXG4vLyBUaGUgYFdpbmRvd2AgaW50ZXJmYWNlIGRvZXMgbm90IGhhdmUgYW4gYEVycm9yLnN0YWNrVHJhY2VMaW1pdGAgcHJvcGVydHksIGJ1dFxuLy8gYEpTRE9NRW52aXJvbm1lbnRgIGFzc3VtZXMgaXQgaXMgdGhlcmUuXG5mdW5jdGlvbiBpc1N0cmluZyh2YWx1ZSkge1xuICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJztcbn1cbmNsYXNzIEpTRE9NRW52aXJvbm1lbnQge1xuICBkb207XG4gIGZha2VUaW1lcnM7XG4gIGZha2VUaW1lcnNNb2Rlcm47XG4gIGdsb2JhbDtcbiAgZXJyb3JFdmVudExpc3RlbmVyO1xuICBtb2R1bGVNb2NrZXI7XG4gIGN1c3RvbUV4cG9ydENvbmRpdGlvbnMgPSBbJ2Jyb3dzZXInXTtcbiAgX2NvbmZpZ3VyZWRFeHBvcnRDb25kaXRpb25zO1xuICBjb25zdHJ1Y3Rvcihjb25maWcsIGNvbnRleHQpIHtcbiAgICBjb25zdCB7cHJvamVjdENvbmZpZ30gPSBjb25maWc7XG4gICAgY29uc3QgdmlydHVhbENvbnNvbGUgPSBuZXcgKF9qc2RvbSgpLlZpcnR1YWxDb25zb2xlKSgpO1xuICAgIHZpcnR1YWxDb25zb2xlLnNlbmRUbyhjb250ZXh0LmNvbnNvbGUsIHtcbiAgICAgIG9taXRKU0RPTUVycm9yczogdHJ1ZVxuICAgIH0pO1xuICAgIHZpcnR1YWxDb25zb2xlLm9uKCdqc2RvbUVycm9yJywgZXJyb3IgPT4ge1xuICAgICAgY29udGV4dC5jb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICB9KTtcbiAgICB0aGlzLmRvbSA9IG5ldyAoX2pzZG9tKCkuSlNET00pKFxuICAgICAgdHlwZW9mIHByb2plY3RDb25maWcudGVzdEVudmlyb25tZW50T3B0aW9ucy5odG1sID09PSAnc3RyaW5nJ1xuICAgICAgICA/IHByb2plY3RDb25maWcudGVzdEVudmlyb25tZW50T3B0aW9ucy5odG1sXG4gICAgICAgIDogJzwhRE9DVFlQRSBodG1sPicsXG4gICAgICB7XG4gICAgICAgIHByZXRlbmRUb0JlVmlzdWFsOiB0cnVlLFxuICAgICAgICByZXNvdXJjZXM6XG4gICAgICAgICAgdHlwZW9mIHByb2plY3RDb25maWcudGVzdEVudmlyb25tZW50T3B0aW9ucy51c2VyQWdlbnQgPT09ICdzdHJpbmcnXG4gICAgICAgICAgICA/IG5ldyAoX2pzZG9tKCkuUmVzb3VyY2VMb2FkZXIpKHtcbiAgICAgICAgICAgICAgICB1c2VyQWdlbnQ6IHByb2plY3RDb25maWcudGVzdEVudmlyb25tZW50T3B0aW9ucy51c2VyQWdlbnRcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIDogdW5kZWZpbmVkLFxuICAgICAgICBydW5TY3JpcHRzOiAnZGFuZ2Vyb3VzbHknLFxuICAgICAgICB1cmw6ICdodHRwOi8vbG9jYWxob3N0LycsXG4gICAgICAgIHZpcnR1YWxDb25zb2xlLFxuICAgICAgICAuLi5wcm9qZWN0Q29uZmlnLnRlc3RFbnZpcm9ubWVudE9wdGlvbnNcbiAgICAgIH1cbiAgICApO1xuICAgIGNvbnN0IGdsb2JhbCA9ICh0aGlzLmdsb2JhbCA9IHRoaXMuZG9tLndpbmRvdyk7XG4gICAgaWYgKGdsb2JhbCA9PSBudWxsKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0pTRE9NIGRpZCBub3QgcmV0dXJuIGEgV2luZG93IG9iamVjdCcpO1xuICAgIH1cblxuICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgLSBmb3IgXCJ1bml2ZXJzYWxcIiBjb2RlIChjb2RlIHNob3VsZCB1c2UgYGdsb2JhbFRoaXNgKVxuICAgIGdsb2JhbC5nbG9iYWwgPSBnbG9iYWw7XG5cbiAgICAvLyBOb2RlJ3MgZXJyb3ItbWVzc2FnZSBzdGFjayBzaXplIGlzIGxpbWl0ZWQgYXQgMTAsIGJ1dCBpdCdzIHByZXR0eSB1c2VmdWxcbiAgICAvLyB0byBzZWUgbW9yZSB0aGFuIHRoYXQgd2hlbiBhIHRlc3QgZmFpbHMuXG4gICAgdGhpcy5nbG9iYWwuRXJyb3Iuc3RhY2tUcmFjZUxpbWl0ID0gMTAwO1xuICAgICgwLCBfamVzdFV0aWwoKS5pbnN0YWxsQ29tbW9uR2xvYmFscykoZ2xvYmFsLCBwcm9qZWN0Q29uZmlnLmdsb2JhbHMpO1xuXG4gICAgLy8gVE9ETzogcmVtb3ZlIHRoaXMgQVNBUCwgYnV0IGl0IGN1cnJlbnRseSBjYXVzZXMgdGVzdHMgdG8gcnVuIHJlYWxseSBzbG93XG4gICAgZ2xvYmFsLkJ1ZmZlciA9IEJ1ZmZlcjtcblxuICAgIC8vIFJlcG9ydCB1bmNhdWdodCBlcnJvcnMuXG4gICAgdGhpcy5lcnJvckV2ZW50TGlzdGVuZXIgPSBldmVudCA9PiB7XG4gICAgICBpZiAodXNlckVycm9yTGlzdGVuZXJDb3VudCA9PT0gMCAmJiBldmVudC5lcnJvciAhPSBudWxsKSB7XG4gICAgICAgIHByb2Nlc3MuZW1pdCgndW5jYXVnaHRFeGNlcHRpb24nLCBldmVudC5lcnJvcik7XG4gICAgICB9XG4gICAgfTtcbiAgICBnbG9iYWwuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCB0aGlzLmVycm9yRXZlbnRMaXN0ZW5lcik7XG5cbiAgICAvLyBIb3dldmVyLCBkb24ndCByZXBvcnQgdGhlbSBhcyB1bmNhdWdodCBpZiB0aGUgdXNlciBsaXN0ZW5zIHRvICdlcnJvcicgZXZlbnQuXG4gICAgLy8gSW4gdGhhdCBjYXNlLCB3ZSBhc3N1bWUgdGhlIG1pZ2h0IGhhdmUgY3VzdG9tIGVycm9yIGhhbmRsaW5nIGxvZ2ljLlxuICAgIGNvbnN0IG9yaWdpbmFsQWRkTGlzdGVuZXIgPSBnbG9iYWwuYWRkRXZlbnRMaXN0ZW5lci5iaW5kKGdsb2JhbCk7XG4gICAgY29uc3Qgb3JpZ2luYWxSZW1vdmVMaXN0ZW5lciA9IGdsb2JhbC5yZW1vdmVFdmVudExpc3RlbmVyLmJpbmQoZ2xvYmFsKTtcbiAgICBsZXQgdXNlckVycm9yTGlzdGVuZXJDb3VudCA9IDA7XG4gICAgZ2xvYmFsLmFkZEV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbiAoLi4uYXJncykge1xuICAgICAgaWYgKGFyZ3NbMF0gPT09ICdlcnJvcicpIHtcbiAgICAgICAgdXNlckVycm9yTGlzdGVuZXJDb3VudCsrO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG9yaWdpbmFsQWRkTGlzdGVuZXIuYXBwbHkodGhpcywgYXJncyk7XG4gICAgfTtcbiAgICBnbG9iYWwucmVtb3ZlRXZlbnRMaXN0ZW5lciA9IGZ1bmN0aW9uICguLi5hcmdzKSB7XG4gICAgICBpZiAoYXJnc1swXSA9PT0gJ2Vycm9yJykge1xuICAgICAgICB1c2VyRXJyb3JMaXN0ZW5lckNvdW50LS07XG4gICAgICB9XG4gICAgICByZXR1cm4gb3JpZ2luYWxSZW1vdmVMaXN0ZW5lci5hcHBseSh0aGlzLCBhcmdzKTtcbiAgICB9O1xuICAgIGlmICgnY3VzdG9tRXhwb3J0Q29uZGl0aW9ucycgaW4gcHJvamVjdENvbmZpZy50ZXN0RW52aXJvbm1lbnRPcHRpb25zKSB7XG4gICAgICBjb25zdCB7Y3VzdG9tRXhwb3J0Q29uZGl0aW9uc30gPSBwcm9qZWN0Q29uZmlnLnRlc3RFbnZpcm9ubWVudE9wdGlvbnM7XG4gICAgICBpZiAoXG4gICAgICAgIEFycmF5LmlzQXJyYXkoY3VzdG9tRXhwb3J0Q29uZGl0aW9ucykgJiZcbiAgICAgICAgY3VzdG9tRXhwb3J0Q29uZGl0aW9ucy5ldmVyeShpc1N0cmluZylcbiAgICAgICkge1xuICAgICAgICB0aGlzLl9jb25maWd1cmVkRXhwb3J0Q29uZGl0aW9ucyA9IGN1c3RvbUV4cG9ydENvbmRpdGlvbnM7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ0N1c3RvbSBleHBvcnQgY29uZGl0aW9ucyBzcGVjaWZpZWQgYnV0IHRoZXkgYXJlIG5vdCBhbiBhcnJheSBvZiBzdHJpbmdzJ1xuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLm1vZHVsZU1vY2tlciA9IG5ldyAoX2plc3RNb2NrKCkuTW9kdWxlTW9ja2VyKShnbG9iYWwpO1xuICAgIHRoaXMuZmFrZVRpbWVycyA9IG5ldyAoX2Zha2VUaW1lcnMoKS5MZWdhY3lGYWtlVGltZXJzKSh7XG4gICAgICBjb25maWc6IHByb2plY3RDb25maWcsXG4gICAgICBnbG9iYWw6IGdsb2JhbCxcbiAgICAgIG1vZHVsZU1vY2tlcjogdGhpcy5tb2R1bGVNb2NrZXIsXG4gICAgICB0aW1lckNvbmZpZzoge1xuICAgICAgICBpZFRvUmVmOiBpZCA9PiBpZCxcbiAgICAgICAgcmVmVG9JZDogcmVmID0+IHJlZlxuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMuZmFrZVRpbWVyc01vZGVybiA9IG5ldyAoX2Zha2VUaW1lcnMoKS5Nb2Rlcm5GYWtlVGltZXJzKSh7XG4gICAgICBjb25maWc6IHByb2plY3RDb25maWcsXG4gICAgICBnbG9iYWw6IGdsb2JhbFxuICAgIH0pO1xuICB9XG5cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1lbXB0eS1mdW5jdGlvblxuICBhc3luYyBzZXR1cCgpIHt9XG4gIGFzeW5jIHRlYXJkb3duKCkge1xuICAgIGlmICh0aGlzLmZha2VUaW1lcnMpIHtcbiAgICAgIHRoaXMuZmFrZVRpbWVycy5kaXNwb3NlKCk7XG4gICAgfVxuICAgIGlmICh0aGlzLmZha2VUaW1lcnNNb2Rlcm4pIHtcbiAgICAgIHRoaXMuZmFrZVRpbWVyc01vZGVybi5kaXNwb3NlKCk7XG4gICAgfVxuICAgIGlmICh0aGlzLmdsb2JhbCAhPSBudWxsKSB7XG4gICAgICBpZiAodGhpcy5lcnJvckV2ZW50TGlzdGVuZXIpIHtcbiAgICAgICAgdGhpcy5nbG9iYWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignZXJyb3InLCB0aGlzLmVycm9yRXZlbnRMaXN0ZW5lcik7XG4gICAgICB9XG4gICAgICB0aGlzLmdsb2JhbC5jbG9zZSgpO1xuICAgIH1cbiAgICB0aGlzLmVycm9yRXZlbnRMaXN0ZW5lciA9IG51bGw7XG4gICAgLy8gQHRzLWV4cGVjdC1lcnJvcjogdGhpcy5nbG9iYWwgbm90IGFsbG93ZWQgdG8gYmUgYG51bGxgXG4gICAgdGhpcy5nbG9iYWwgPSBudWxsO1xuICAgIHRoaXMuZG9tID0gbnVsbDtcbiAgICB0aGlzLmZha2VUaW1lcnMgPSBudWxsO1xuICAgIHRoaXMuZmFrZVRpbWVyc01vZGVybiA9IG51bGw7XG4gIH1cbiAgZXhwb3J0Q29uZGl0aW9ucygpIHtcbiAgICByZXR1cm4gdGhpcy5fY29uZmlndXJlZEV4cG9ydENvbmRpdGlvbnMgPz8gdGhpcy5jdXN0b21FeHBvcnRDb25kaXRpb25zO1xuICB9XG4gIGdldFZtQ29udGV4dCgpIHtcbiAgICBpZiAodGhpcy5kb20pIHtcbiAgICAgIHJldHVybiB0aGlzLmRvbS5nZXRJbnRlcm5hbFZNQ29udGV4dCgpO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuZXhwb3J0cy5kZWZhdWx0ID0gSlNET01FbnZpcm9ubWVudDtcbmNvbnN0IFRlc3RFbnZpcm9ubWVudCA9IEpTRE9NRW52aXJvbm1lbnQ7XG5leHBvcnRzLlRlc3RFbnZpcm9ubWVudCA9IFRlc3RFbnZpcm9ubWVudDtcbiJdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWTs7QUFFWkEsTUFBTSxDQUFDQyxjQUFjLENBQUNDLE9BQU8sRUFBRSxZQUFZLEVBQUU7RUFDM0NDLEtBQUssRUFBRTtBQUNULENBQUMsQ0FBQztBQUNGRCxPQUFPLENBQUNFLE9BQU8sR0FBR0YsT0FBTyxDQUFDRyxlQUFlLEdBQUcsS0FBSyxDQUFDO0FBQ2xELFNBQVNDLE1BQU1BLENBQUEsRUFBRztFQUNoQixNQUFNQyxJQUFJLEdBQUdDLE9BQU8sQ0FBQyxPQUFPLENBQUM7RUFDN0JGLE1BQU0sR0FBRyxTQUFBQSxDQUFBLEVB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