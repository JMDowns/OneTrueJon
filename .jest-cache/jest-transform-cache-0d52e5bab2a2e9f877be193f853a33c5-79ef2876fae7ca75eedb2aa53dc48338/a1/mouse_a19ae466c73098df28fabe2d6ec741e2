16bc82d2de949b0091e19e1bbf249933
'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});
require('../../event/behavior/click.js');
require('../../event/behavior/cut.js');
require('../../event/behavior/keydown.js');
require('../../event/behavior/keypress.js');
require('../../event/behavior/keyup.js');
require('../../event/behavior/paste.js');
require('@testing-library/dom');
require('../../event/eventMap.js');
require('../../utils/click/isClickableInput.js');
require('../../utils/dataTransfer/Clipboard.js');
require('../../utils/edit/isEditable.js');
require('../../utils/edit/maxLength.js');
var isDisabled = require('../../utils/misc/isDisabled.js');
require('@testing-library/dom/dist/helpers.js');
require('../../utils/keyDef/readNextDescriptor.js');
var getTreeDiff = require('../../utils/misc/getTreeDiff.js');
require('../../utils/misc/level.js');
require('../../options.js');
var focus = require('../../event/focus.js');
var setSelectionPerMouse = require('../../event/selection/setSelectionPerMouse.js');
var modifySelectionPerMouse = require('../../event/selection/modifySelectionPerMouse.js');
var buttons = require('./buttons.js');
var shared = require('./shared.js');
function _define_property(obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }
  return obj;
}
/**
 * This object is the single "virtual" mouse that might be controlled by multiple different pointer devices.
 */
class Mouse {
  move(instance, position) {
    const prevPosition = this.position;
    const prevTarget = this.getTarget(instance);
    this.position = position;
    if (!shared.isDifferentPointerPosition(prevPosition, position)) {
      return;
    }
    const nextTarget = this.getTarget(instance);
    const init = this.getEventInit('mousemove');
    const [leave, enter] = getTreeDiff.getTreeDiff(prevTarget, nextTarget);
    return {
      leave: () => {
        if (prevTarget !== nextTarget) {
          instance.dispatchUIEvent(prevTarget, 'mouseout', init);
          leave.forEach(el => instance.dispatchUIEvent(el, 'mouseleave', init));
        }
      },
      enter: () => {
        if (prevTarget !== nextTarget) {
          instance.dispatchUIEvent(nextTarget, 'mouseover', init);
          enter.forEach(el => instance.dispatchUIEvent(el, 'mouseenter', init));
        }
      },
      move: () => {
        instance.dispatchUIEvent(nextTarget, 'mousemove', init);
        this.modifySelecting(instance);
      }
    };
  }
  down(instance, keyDef, pointer) {
    const button = this.buttons.down(keyDef);
    if (button === undefined) {
      return;
    }
    const target = this.getTarget(instance);
    this.buttonDownTarget[button] = target;
    const disabled = isDisabled.isDisabled(target);
    const init = this.getEventInit('mousedown', keyDef.button);
    if (disabled || instance.dispatchUIEvent(target, 'mousedown', init)) {
      this.startSelecting(instance, init.detail);
      focus.focusElement(target);
    }
    if (!disabled && buttons.getMouseEventButton(keyDef.button) === 2) {
      instance.dispatchUIEvent(target, 'contextmenu', this.getEventInit('contextmenu', keyDef.button, pointer));
    }
  }
  up(instance, keyDef, pointer) {
    const button = this.buttons.up(keyDef);
    if (button === undefined) {
      return;
    }
    const target = this.getTarget(instance);
    if (!isDisabled.isDisabled(target)) {
      instance.dispatchUIEvent(target, 'mouseup', this.getEventInit('mouseup', keyDef.button));
      this.endSelecting();
      const clickTarget = getTreeDiff.getTreeDiff(this.buttonDownTarget[button], target)[2][0];
      if (clickTarget) {
        const init = this.getEventInit('click', keyDef.button, pointer);
        if (init.detail) {
          instance.dispatchUIEvent(clickTarget, init.button === 0 ? 'click' : 'auxclick', init);
          if (init.button === 0 && init.detail === 2) {
            instance.dispatchUIEvent(clickTarget, 'dblclick', {
              ...this.getEventInit('dblclick', keyDef.button),
              detail: init.detail
            });
          }
        }
      }
    }
  }
  resetClickCount() {
    this.clickCount.reset();
  }
  getEventInit(type, button, pointer) {
    const init = {
      ...this.position.coords
    };
    if (pointer) {
      init.pointerId = pointer.pointerId;
      init.pointerType = pointer.pointerType;
      init.isPrimary = pointer.isPrimary;
    }
    init.button = buttons.getMouseEventButton(button);
    init.buttons = this.buttons.getButtons();
    if (type === 'mousedown') {
      init.detail = this.clickCount.getOnDown(init.button);
    } else if (type === 'mouseup') {
      init.detail = this.clickCount.getOnUp(init.button);
    } else if (type === 'click' || type === 'auxclick') {
      init.detail = this.clickCount.incOnClick(init.button);
    }
    return init;
  }
  getTarget(instance) {
    var _this_position_target;
    return (_this_position_target = this.position.target) !== null && _this_position_target !== void 0 ? _this_position_target : instance.config.document.body;
  }
  startSelecting(instance, clickCount) {
    var _this_position_caret, _this_position_caret1;
    // TODO: support extending range (shift)
    this.selecting = setSelectionPerMouse.setSelectionPerMouseDown({
      document: instance.config.document,
      target: this.getTarget(instance),
      node: (_this_position_caret = this.position.caret) === null || _this_position_caret === void 0 ? void 0 : _this_position_caret.node,
      offset: (_this_position_caret1 = this.position.caret) === null || _this_position_caret1 === void 0 ? void 0 : _this_position_caret1.offset,
      clickCount
    });
  }
  modifySelecting(instance) {
    var _this_position_caret, _this_position_caret1;
    if (!this.selecting) {
      return;
    }
    modifySelectionPerMouse.modifySelectionPerMouseMove(this.selecting, {
      document: instance.config.document,
      target: this.getTarget(instance),
      node: (_this_position_caret = this.position.caret) === null || _this_position_caret === void 0 ? void 0 : _this_position_caret.node,
      offset: (_this_position_caret1 = this.position.caret) === null || _this_position_caret1 === void 0 ? void 0 : _this_position_caret1.offset
    });
  }
  endSelecting() {
    this.selecting = undefined;
  }
  constructor() {
    _define_property(this, "position", {});
    _define_property(this, "buttons", new buttons.Buttons());
    _define_property(this, "selecting", void 0);
    _define_property(this, "buttonDownTarget", {});
    // According to spec the `detail` on click events should be the number
    // of *consecutive* clicks with a specific button.
    // On `mousedown` and `mouseup` it should be this number increased by one.
    // But the browsers don't implement it this way.
    // If another button is pressed,
    //   in Webkit: the `mouseup` on the previously pressed button has `detail: 0` and no `click`/`auxclick`.
    //   in Gecko: the `mouseup` and click events have the same detail as the `mousedown`.
    // If there is a delay while a button is pressed,
    // the `mouseup` and `click` are normal, but a following `mousedown` starts a new click count.
    // We'll follow the minimal implementation of Webkit.
    _define_property(this, "clickCount", new class {
      incOnClick(button) {
        const current = this.down[button] === undefined ? undefined : Number(this.down[button]) + 1;
        this.count = this.count[button] === undefined ? {} : {
          [button]: Number(this.count[button]) + 1
        };
        return current;
      }
      getOnDown(button) {
        var _this_count_button;
        this.down = {
          [button]: (_this_count_button = this.count[button]) !== null && _this_count_button !== void 0 ? _this_count_button : 0
        };
        var _this_count_button1;
        this.count = {
          [button]: (_this_count_button1 = this.count[button]) !== null && _this_count_button1 !== void 0 ? _this_count_button1 : 0
        };
        return Number(this.count[button]) + 1;
      }
      getOnUp(button) {
        return this.down[button] === undefined ? undefined : Number(this.down[button]) + 1;
      }
      reset() {
        this.count = {};
      }
      constructor() {
        _define_property(this, "down", {});
        _define_property(this, "count", {});
      }
    }());
  }
}
exports.Mouse = Mouse;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsInJlcXVpcmUiLCJpc0Rpc2FibGVkIiwiZ2V0VHJlZURpZmYiLCJmb2N1cyIsInNldFNlbGVjdGlvblBlck1vdXNlIiwibW9kaWZ5U2VsZWN0aW9uUGVyTW91c2UiLCJidXR0b25zIiwic2hhcmVkIiwiX2RlZmluZV9wcm9wZXJ0eSIsIm9iaiIsImtleSIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsIk1vdXNlIiwibW92ZSIsImluc3RhbmNlIiwicG9zaXRpb24iLCJwcmV2UG9zaXRpb24iLCJwcmV2VGFyZ2V0IiwiZ2V0VGFyZ2V0IiwiaXNEaWZmZXJlbnRQb2ludGVyUG9zaXRpb24iLCJuZXh0VGFyZ2V0IiwiaW5pdCIsImdldEV2ZW50SW5pdCIsImxlYXZlIiwiZW50ZXIiLCJkaXNwYXRjaFVJRXZlbnQiLCJmb3JFYWNoIiwiZWwiLCJtb2RpZnlTZWxlY3RpbmciLCJkb3duIiwia2V5RGVmIiwicG9pbnRlciIsImJ1dHRvbiIsInVuZGVmaW5lZCIsInRhcmdldCIsImJ1dHRvbkRvd25UYXJnZXQiLCJkaXNhYmxlZCIsInN0YXJ0U2VsZWN0aW5nIiwiZGV0YWlsIiwiZm9jdXNFbGVtZW50IiwiZ2V0TW91c2VFdmVudEJ1dHRvbiIsInVwIiwiZW5kU2VsZWN0aW5nIiwiY2xpY2tUYXJnZXQiLCJyZXNldENsaWNrQ291bnQiLCJjbGlja0NvdW50IiwicmVzZXQiLCJ0eXBlIiwiY29vcmRzIiwicG9pbnRlcklkIiwicG9pbnRlclR5cGUiLCJpc1ByaW1hcnkiLCJnZXRCdXR0b25zIiwiZ2V0T25Eb3duIiwiZ2V0T25VcCIsImluY09uQ2xpY2siLCJfdGhpc19wb3NpdGlvbl90YXJnZXQiLCJjb25maWciLCJkb2N1bWVudCIsImJvZHkiLCJfdGhpc19wb3NpdGlvbl9jYXJldCIsIl90aGlzX3Bvc2l0aW9uX2NhcmV0MSIsInNlbGVjdGluZyIsInNldFNlbGVjdGlvblBlck1vdXNlRG93biIsIm5vZGUiLCJjYXJldCIsIm9mZnNldCIsIm1vZGlmeVNlbGVjdGlvblBlck1vdXNlTW92ZSIsImNvbnN0cnVjdG9yIiwiQnV0dG9ucyIsImN1cnJlbnQiLCJOdW1iZXIiLCJjb3VudCIsIl90aGlzX2NvdW50X2J1dHRvbiIsIl90aGlzX2NvdW50X2J1dHRvbjEiXSwic291cmNlcyI6WyJtb3VzZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG5cbnJlcXVpcmUoJy4uLy4uL2V2ZW50L2JlaGF2aW9yL2NsaWNrLmpzJyk7XG5yZXF1aXJlKCcuLi8uLi9ldmVudC9iZWhhdmlvci9jdXQuanMnKTtcbnJlcXVpcmUoJy4uLy4uL2V2ZW50L2JlaGF2aW9yL2tleWRvd24uanMnKTtcbnJlcXVpcmUoJy4uLy4uL2V2ZW50L2JlaGF2aW9yL2tleXByZXNzLmpzJyk7XG5yZXF1aXJlKCcuLi8uLi9ldmVudC9iZWhhdmlvci9rZXl1cC5qcycpO1xucmVxdWlyZSgnLi4vLi4vZXZlbnQvYmVoYXZpb3IvcGFzdGUuanMnKTtcbnJlcXVpcmUoJ0B0ZXN0aW5nLWxpYnJhcnkvZG9tJyk7XG5yZXF1aXJlKCcuLi8uLi9ldmVudC9ldmVudE1hcC5qcycpO1xucmVxdWlyZSgnLi4vLi4vdXRpbHMvY2xpY2svaXNDbGlja2FibGVJbnB1dC5qcycpO1xucmVxdWlyZSgnLi4vLi4vdXRpbHMvZGF0YVRyYW5zZmVyL0NsaXBib2FyZC5qcycpO1xucmVxdWlyZSgnLi4vLi4vdXRpbHMvZWRpdC9pc0VkaXRhYmxlLmpzJyk7XG5yZXF1aXJlKCcuLi8uLi91dGlscy9lZGl0L21heExlbmd0aC5qcycpO1xudmFyIGlzRGlzYWJsZWQgPSByZXF1aXJlKCcuLi8uLi91dGlscy9taXNjL2lzRGlzYWJsZWQuanMnKTtcbnJlcXVpcmUoJ0B0ZXN0aW5nLWxpYnJhcnkvZG9tL2Rpc3QvaGVscGVycy5qcycpO1xucmVxdWlyZSgnLi4vLi4vdXRpbHMva2V5RGVmL3JlYWROZXh0RGVzY3JpcHRvci5qcycpO1xudmFyIGdldFRyZWVEaWZmID0gcmVxdWlyZSgnLi4vLi4vdXRpbHMvbWlzYy9nZXRUcmVlRGlmZi5qcycpO1xucmVxdWlyZSgnLi4vLi4vdXRpbHMvbWlzYy9sZXZlbC5qcycpO1xucmVxdWlyZSgnLi4vLi4vb3B0aW9ucy5qcycpO1xudmFyIGZvY3VzID0gcmVxdWlyZSgnLi4vLi4vZXZlbnQvZm9jdXMuanMnKTtcbnZhciBzZXRTZWxlY3Rpb25QZXJNb3VzZSA9IHJlcXVpcmUoJy4uLy4uL2V2ZW50L3NlbGVjdGlvbi9zZXRTZWxlY3Rpb25QZXJNb3VzZS5qcycpO1xudmFyIG1vZGlmeVNlbGVjdGlvblBlck1vdXNlID0gcmVxdWlyZSgnLi4vLi4vZXZlbnQvc2VsZWN0aW9uL21vZGlmeVNlbGVjdGlvblBlck1vdXNlLmpzJyk7XG52YXIgYnV0dG9ucyA9IHJlcXVpcmUoJy4vYnV0dG9ucy5qcycpO1xudmFyIHNoYXJlZCA9IHJlcXVpcmUoJy4vc2hhcmVkLmpzJyk7XG5cbmZ1bmN0aW9uIF9kZWZpbmVfcHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7XG4gICAgaWYgKGtleSBpbiBvYmopIHtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7XG4gICAgICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgd3JpdGFibGU6IHRydWVcbiAgICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgb2JqW2tleV0gPSB2YWx1ZTtcbiAgICB9XG4gICAgcmV0dXJuIG9iajtcbn1cbi8qKlxuICogVGhpcyBvYmplY3QgaXMgdGhlIHNpbmdsZSBcInZpcnR1YWxcIiBtb3VzZSB0aGF0IG1pZ2h0IGJlIGNvbnRyb2xsZWQgYnkgbXVsdGlwbGUgZGlmZmVyZW50IHBvaW50ZXIgZGV2aWNlcy5cbiAqLyBjbGFzcyBNb3VzZSB7XG4gICAgbW92ZShpbnN0YW5jZSwgcG9zaXRpb24pIHtcbiAgICAgICAgY29uc3QgcHJldlBvc2l0aW9uID0gdGhpcy5wb3NpdGlvbjtcbiAgICAgICAgY29uc3QgcHJldlRhcmdldCA9IHRoaXMuZ2V0VGFyZ2V0KGluc3RhbmNlKTtcbiAgICAgICAgdGhpcy5wb3NpdGlvbiA9IHBvc2l0aW9uO1xuICAgICAgICBpZiAoIXNoYXJlZC5pc0RpZmZlcmVudFBvaW50ZXJQb3NpdGlvbihwcmV2UG9zaXRpb24sIHBvc2l0aW9uKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG5leHRUYXJnZXQgPSB0aGlzLmdldFRhcmdldChpbnN0YW5jZSk7XG4gICAgICAgIGNvbnN0IGluaXQgPSB0aGlzLmdldEV2ZW50SW5pdCgnbW91c2Vtb3ZlJyk7XG4gICAgICAgIGNvbnN0IFtsZWF2ZSwgZW50ZXJdID0gZ2V0VHJlZURpZmYuZ2V0VHJlZURpZmYocHJldlRhcmdldCwgbmV4dFRhcmdldCk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBsZWF2ZTogKCk9PntcbiAgICAgICAgICAgICAgICBpZiAocHJldlRhcmdldCAhPT0gbmV4dFRhcmdldCkge1xuICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZS5kaXNwYXRjaFVJRXZlbnQocHJldlRhcmdldCwgJ21vdXNlb3V0JywgaW5pdCk7XG4gICAgICAgICAgICAgICAgICAgIGxlYXZlLmZvckVhY2goKGVsKT0+aW5zdGFuY2UuZGlzcGF0Y2hVSUV2ZW50KGVsLCAnbW91c2VsZWF2ZScsIGluaXQpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZW50ZXI6ICgpPT57XG4gICAgICAgICAgICAgICAgaWYgKHByZXZUYXJnZXQgIT09IG5leHRUYXJnZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2UuZGlzcGF0Y2hVSUV2ZW50KG5leHRUYXJnZXQsICdtb3VzZW92ZXInLCBpbml0KTtcbiAgICAgICAgICAgICAgICAgICAgZW50ZXIuZm9yRWFjaCgoZWwpPT5pbnN0YW5jZS5kaXNwYXRjaFVJRXZlbnQoZWwsICdtb3VzZWVudGVyJywgaW5pdCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtb3ZlOiAoKT0+e1xuICAgICAgICAgICAgICAgIGluc3RhbmNlLmRpc3BhdGNoVUlFdmVudChuZXh0VGFyZ2V0LCAnbW91c2Vtb3ZlJywgaW5pdCk7XG4gICAgICAgICAgICAgICAgdGhpcy5tb2RpZnlTZWxlY3RpbmcoaW5zdGFuY2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cbiAgICBkb3duKGluc3RhbmNlLCBrZXlEZWYsIHBvaW50ZXIpIHtcbiAgICAgICAgY29uc3QgYnV0dG9uID0gdGhpcy5idXR0b25zLmRvd24oa2V5RGVmKTtcbiAgICAgICAgaWYgKGJ1dHRvbiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdGFyZ2V0ID0gdGhpcy5nZXRUYXJnZXQoaW5zdGFuY2UpO1xuICAgICAgICB0aGlzLmJ1dHRvbkRvd25UYXJnZXRbYnV0dG9uXSA9IHRhcmdldDtcbiAgICAgICAgY29uc3QgZGlzYWJsZWQgPSBpc0Rpc2FibGVkLmlzRGlzYWJsZWQodGFyZ2V0KTtcbiAgICAgICAgY29uc3QgaW5pdCA9IHRoaXMuZ2V0RXZlbnRJbml0KCdtb3VzZWRvd24nLCBrZXlEZWYuYnV0dG9uKTtcbiAgICAgICAgaWYgKGRpc2FibGVkIHx8IGluc3RhbmNlLmRpc3BhdGNoVUlFdmVudCh0YXJnZXQsICdtb3VzZWRvd24nLCBpbml0KSkge1xuICAgICAgICAgICAgdGhpcy5zdGFydFNlbGVjdGluZyhpbnN0YW5jZSwgaW5pdC5kZXRhaWwpO1xuICAgICAgICAgICAgZm9jdXMuZm9jdXNFbGVtZW50KHRhcmdldCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFkaXNhYmxlZCAmJiBidXR0b25zLmdldE1vdXNlRXZlbnRCdXR0b24oa2V5RGVmLmJ1dHRvbikgPT09IDIpIHtcbiAgICAgICAgICAgIGluc3RhbmNlLmRpc3BhdGNoVUlFdmVudCh0YXJnZXQsICdjb250ZXh0bWVudScsIHRoaXMuZ2V0RXZlbnRJbml0KCdjb250ZXh0bWVudScsIGtleURlZi5idXR0b24sIHBvaW50ZXIpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB1cChpbnN0YW5jZSwga2V5RGVmLCBwb2ludGVyKSB7XG4gICAgICAgIGNvbnN0IGJ1dHRvbiA9IHRoaXMuYnV0dG9ucy51cChrZXlEZWYpO1xuICAgICAgICBpZiAoYnV0dG9uID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB0YXJnZXQgPSB0aGlzLmdldFRhcmdldChpbnN0YW5jZSk7XG4gICAgICAgIGlmICghaXNEaXNhYmxlZC5pc0Rpc2FibGVkKHRhcmdldCkpIHtcbiAgICAgICAgICAgIGluc3RhbmNlLmRpc3BhdGNoVUlFdmVudCh0YXJnZXQsICdtb3VzZXVwJywgdGhpcy5nZXRFdmVudEluaXQoJ21vdXNldXAnLCBrZXlEZWYuYnV0dG9uKSk7XG4gICAgICAgICAgICB0aGlzLmVuZFNlbGVjdGluZygpO1xuICAgICAgICAgICAgY29uc3QgY2xpY2tUYXJnZXQgPSBnZXRUcmVlRGlmZi5nZXRUcmVlRGlmZih0aGlzLmJ1dHRvbkRvd25UYXJnZXRbYnV0dG9uXSwgdGFyZ2V0KVsyXVswXTtcbiAgICAgICAgICAgIGlmIChjbGlja1RhcmdldCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGluaXQgPSB0aGlzLmdldEV2ZW50SW5pdCgnY2xpY2snLCBrZXlEZWYuYnV0dG9uLCBwb2ludGVyKTtcbiAgICAgICAgICAgICAgICBpZiAoaW5pdC5kZXRhaWwpIHtcbiAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2UuZGlzcGF0Y2hVSUV2ZW50KGNsaWNrVGFyZ2V0LCBpbml0LmJ1dHRvbiA9PT0gMCA/ICdjbGljaycgOiAnYXV4Y2xpY2snLCBpbml0KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluaXQuYnV0dG9uID09PSAwICYmIGluaXQuZGV0YWlsID09PSAyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZS5kaXNwYXRjaFVJRXZlbnQoY2xpY2tUYXJnZXQsICdkYmxjbGljaycsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuLi50aGlzLmdldEV2ZW50SW5pdCgnZGJsY2xpY2snLCBrZXlEZWYuYnV0dG9uKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXRhaWw6IGluaXQuZGV0YWlsXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZXNldENsaWNrQ291bnQoKSB7XG4gICAgICAgIHRoaXMuY2xpY2tDb3VudC5yZXNldCgpO1xuICAgIH1cbiAgICBnZXRFdmVudEluaXQodHlwZSwgYnV0dG9uLCBwb2ludGVyKSB7XG4gICAgICAgIGNvbnN0IGluaXQgPSB7XG4gICAgICAgICAgICAuLi50aGlzLnBvc2l0aW9uLmNvb3Jkc1xuICAgICAgICB9O1xuICAgICAgICBpZiAocG9pbnRlcikge1xuICAgICAgICAgICAgaW5pdC5wb2ludGVySWQgPSBwb2ludGVyLnBvaW50ZXJJZDtcbiAgICAgICAgICAgIGluaXQucG9pbnRlclR5cGUgPSBwb2ludGVyLnBvaW50ZXJUeXBlO1xuICAgICAgICAgICAgaW5pdC5pc1ByaW1hcnkgPSBwb2ludGVyLmlzUHJpbWFyeTtcbiAgICAgICAgfVxuICAgICAgICBpbml0LmJ1dHRvbiA9IGJ1dHRvbnMuZ2V0TW91c2VFdmVudEJ1dHRvbihidXR0b24pO1xuICAgICAgICBpbml0LmJ1dHRvbnMgPSB0aGlzLmJ1dHRvbnMuZ2V0QnV0dG9ucygpO1xuICAgICAgICBpZiAodHlwZSA9PT0gJ21vdXNlZG93bicpIHtcbiAgICAgICAgICAgIGluaXQuZGV0YWlsID0gdGhpcy5jbGlja0NvdW50LmdldE9uRG93bihpbml0LmJ1dHRvbik7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ21vdXNldXAnKSB7XG4gICAgICAgICAgICBpbml0LmRldGFpbCA9IHRoaXMuY2xpY2tDb3VudC5nZXRPblVwKGluaXQuYnV0dG9uKTtcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnY2xpY2snIHx8IHR5cGUgPT09ICdhdXhjbGljaycpIHtcbiAgICAgICAgICAgIGluaXQuZGV0YWlsID0gdGhpcy5jbGlja0NvdW50LmluY09uQ2xpY2soaW5pdC5idXR0b24pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpbml0O1xuICAgIH1cbiAgICBnZXRUYXJnZXQoaW5zdGFuY2UpIHtcbiAgICAgICAgdmFyIF90aGlzX3Bvc2l0aW9uX3RhcmdldDtcbiAgICAgICAgcmV0dXJuIChfdGhpc19wb3NpdGlvbl90YXJnZXQgPSB0aGlzLnBvc2l0aW9uLnRhcmdldCkgIT09IG51bGwgJiYgX3RoaXNfcG9zaXRpb25fdGFyZ2V0ICE9PSB2b2lkIDAgPyBfdGhpc19wb3NpdGlvbl90YXJnZXQgOiBpbnN0YW5jZS5jb25maWcuZG9jdW1lbnQuYm9keTtcbiAgICB9XG4gICAgc3RhcnRTZWxlY3RpbmcoaW5zdGFuY2UsIGNsaWNrQ291bnQpIHtcbiAgICAgICAgdmFyIF90aGlzX3Bvc2l0aW9uX2NhcmV0LCBfdGhpc19wb3NpdGlvbl9jYXJldDE7XG4gICAgICAgIC8vIFRPRE86IHN1cHBvcnQgZXh0ZW5kaW5nIHJhbmdlIChzaGlmdClcbiAgICAgICAgdGhpcy5zZWxlY3RpbmcgPSBzZXRTZWxlY3Rpb25QZXJNb3VzZS5zZXRTZWxlY3Rpb25QZXJNb3VzZURvd24oe1xuICAgICAgICAgICAgZG9jdW1lbnQ6IGluc3RhbmNlLmNvbmZpZy5kb2N1bWVudCxcbiAgICAgICAgICAgIHRhcmdldDogdGhpcy5nZXRUYXJnZXQoaW5zdGFuY2UpLFxuICAgICAgICAgICAgbm9kZTogKF90aGlzX3Bvc2l0aW9uX2NhcmV0ID0gdGhpcy5wb3NpdGlvbi5jYXJldCkgPT09IG51bGwgfHwgX3RoaXNfcG9zaXRpb25fY2FyZXQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF90aGlzX3Bvc2l0aW9uX2NhcmV0Lm5vZGUsXG4gICAgICAgICAgICBvZmZzZXQ6IChfdGhpc19wb3NpdGlvbl9jYXJldDEgPSB0aGlzLnBvc2l0aW9uLmNhcmV0KSA9PT0gbnVsbCB8fCBfdGhpc19wb3NpdGlvbl9jYXJldDEgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF90aGlzX3Bvc2l0aW9uX2NhcmV0MS5vZmZzZXQsXG4gICAgICAgICAgICBjbGlja0NvdW50XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBtb2RpZnlTZWxlY3RpbmcoaW5zdGFuY2UpIHtcbiAgICAgICAgdmFyIF90aGlzX3Bvc2l0aW9uX2NhcmV0LCBfdGhpc19wb3NpdGlvbl9jYXJldDE7XG4gICAgICAgIGlmICghdGhpcy5zZWxlY3RpbmcpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBtb2RpZnlTZWxlY3Rpb25QZXJNb3VzZS5tb2RpZnlTZWxlY3Rpb25QZXJNb3VzZU1vdmUodGhpcy5zZWxlY3RpbmcsIHtcbiAgICAgICAgICAgIGRvY3VtZW50OiBpbnN0YW5jZS5jb25maWcuZG9jdW1lbnQsXG4gICAgICAgICAgICB0YXJnZXQ6IHRoaXMuZ2V0VGFyZ2V0KGluc3RhbmNlKSxcbiAgICAgICAgICAgIG5vZGU6IChfdGhpc19wb3NpdGlvbl9jYXJldCA9IHRoaXMucG9zaXRpb24uY2FyZXQpID09PSBudWxsIHx8IF90aGlzX3Bvc2l0aW9uX2NhcmV0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdGhpc19wb3NpdGlvbl9jYXJldC5ub2RlLFxuICAgICAgICAgICAgb2Zmc2V0OiAoX3RoaXNfcG9zaXRpb25fY2FyZXQxID0gdGhpcy5wb3NpdGlvbi5jYXJldCkgPT09IG51bGwgfHwgX3RoaXNfcG9zaXRpb25fY2FyZXQxID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdGhpc19wb3NpdGlvbl9jYXJldDEub2Zmc2V0XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBlbmRTZWxlY3RpbmcoKSB7XG4gICAgICAgIHRoaXMuc2VsZWN0aW5nID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBjb25zdHJ1Y3Rvcigpe1xuICAgICAgICBfZGVmaW5lX3Byb3BlcnR5KHRoaXMsIFwicG9zaXRpb25cIiwge30pO1xuICAgICAgICBfZGVmaW5lX3Byb3BlcnR5KHRoaXMsIFwiYnV0dG9uc1wiLCBuZXcgYnV0dG9ucy5CdXR0b25zKCkpO1xuICAgICAgICBfZGVmaW5lX3Byb3BlcnR5KHRoaXMsIFwic2VsZWN0aW5nXCIsIHZvaWQgMCk7XG4gICAgICAgIF9kZWZpbmVfcHJvcGVydHkodGhpcywgXCJidXR0b25Eb3duVGFyZ2V0XCIsIHt9KTtcbiAgICAgICAgLy8gQWNjb3JkaW5nIHRvIHNwZWMgdGhlIGBkZXRhaWxgIG9uIGNsaWNrIGV2ZW50cyBzaG91bGQgYmUgdGhlIG51bWJlclxuICAgICAgICAvLyBvZiAqY29uc2VjdXRpdmUqIGNsaWNrcyB3aXRoIGEgc3BlY2lmaWMgYnV0dG9uLlxuICAgICAgICAvLyBPbiBgbW91c2Vkb3duYCBhbmQgYG1vdXNldXBgIGl0IHNob3VsZCBiZSB0aGlzIG51bWJlciBpbmNyZWFzZWQgYnkgb25lLlxuICAgICAgICAvLyBCdXQgdGhlIGJyb3dzZXJzIGRvbid0IGltcGxlbWVudCBpdCB0aGlzIHdheS5cbiAgICAgICAgLy8gSWYgYW5vdGhlciBidXR0b24gaXMgcHJlc3NlZCxcbiAgICAgICAgLy8gICBpbiBXZWJraXQ6IHRoZSBgbW91c2V1cGAgb24gdGhlIHByZXZpb3VzbHkgcHJlc3NlZCBidXR0b24gaGFzIGBkZXRhaWw6IDBgIGFuZCBubyBgY2xpY2tgL2BhdXhjbGlja2AuXG4gICAgICAgIC8vICAgaW4gR2Vja286IHRoZSBgbW91c2V1cGAgYW5kIGNsaWNrIGV2ZW50cyBoYXZlIHRoZSBzYW1lIGRldGFpbCBhcyB0aGUgYG1vdXNlZG93bmAuXG4gICAgICAgIC8vIElmIHRoZXJlIGlzIGEgZGVsYXkgd2hpbGUgYSBidXR0b24gaXMgcHJlc3NlZCxcbiAgICAgICAgLy8gdGhlIGBtb3VzZXVwYCBhbmQgYGNsaWNrYCBhcmUgbm9ybWFsLCBidXQgYSBmb2xsb3dpbmcgYG1vdXNlZG93bmAgc3RhcnRzIGEgbmV3IGNsaWNrIGNvdW50LlxuICAgICAgICAvLyBXZSdsbCBmb2xsb3cgdGhlIG1pbmltYWwgaW1wbGVtZW50YXRpb24gb2YgV2Via2l0LlxuICAgICAgICBfZGVmaW5lX3Byb3BlcnR5KHRoaXMsIFwiY2xpY2tDb3VudFwiLCBuZXcgY2xhc3Mge1xuICAgICAgICAgICAgaW5jT25DbGljayhidXR0b24pIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50ID0gdGhpcy5kb3duW2J1dHRvbl0gPT09IHVuZGVmaW5lZCA/IHVuZGVmaW5lZCA6IE51bWJlcih0aGlzLmRvd25bYnV0dG9uXSkgKyAxO1xuICAgICAgICAgICAgICAgIHRoaXMuY291bnQgPSB0aGlzLmNvdW50W2J1dHRvbl0gPT09IHVuZGVmaW5lZCA/IHt9IDoge1xuICAgICAgICAgICAgICAgICAgICBbYnV0dG9uXTogTnVtYmVyKHRoaXMuY291bnRbYnV0dG9uXSkgKyAxXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICByZXR1cm4gY3VycmVudDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGdldE9uRG93bihidXR0b24pIHtcbiAgICAgICAgICAgICAgICB2YXIgX3RoaXNfY291bnRfYnV0dG9uO1xuICAgICAgICAgICAgICAgIHRoaXMuZG93biA9IHtcbiAgICAgICAgICAgICAgICAgICAgW2J1dHRvbl06IChfdGhpc19jb3VudF9idXR0b24gPSB0aGlzLmNvdW50W2J1dHRvbl0pICE9PSBudWxsICYmIF90aGlzX2NvdW50X2J1dHRvbiAhPT0gdm9pZCAwID8gX3RoaXNfY291bnRfYnV0dG9uIDogMFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgdmFyIF90aGlzX2NvdW50X2J1dHRvbjE7XG4gICAgICAgICAgICAgICAgdGhpcy5jb3VudCA9IHtcbiAgICAgICAgICAgICAgICAgICAgW2J1dHRvbl06IChfdGhpc19jb3VudF9idXR0b24xID0gdGhpcy5jb3VudFtidXR0b25dKSAhPT0gbnVsbCAmJiBfdGhpc19jb3VudF9idXR0b24xICE9PSB2b2lkIDAgPyBfdGhpc19jb3VudF9idXR0b24xIDogMFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgcmV0dXJuIE51bWJlcih0aGlzLmNvdW50W2J1dHRvbl0pICsgMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGdldE9uVXAoYnV0dG9uKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZG93bltidXR0b25dID09PSB1bmRlZmluZWQgPyB1bmRlZmluZWQgOiBOdW1iZXIodGhpcy5kb3duW2J1dHRvbl0pICsgMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlc2V0KCkge1xuICAgICAgICAgICAgICAgIHRoaXMuY291bnQgPSB7fTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0cnVjdG9yKCl7XG4gICAgICAgICAgICAgICAgX2RlZmluZV9wcm9wZXJ0eSh0aGlzLCBcImRvd25cIiwge30pO1xuICAgICAgICAgICAgICAgIF9kZWZpbmVfcHJvcGVydHkodGhpcywgXCJjb3VudFwiLCB7fSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0oKSk7XG4gICAgfVxufVxuXG5leHBvcnRzLk1vdXNlID0gTW91c2U7XG4iXSwibWFw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