fbe5cb01022eb92080d0b00a3ac56d47
'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});
var getWindow = require('../misc/getWindow.js');
var Blob = require('./Blob.js');
var DataTransfer = require('./DataTransfer.js');

// Clipboard is not available in jsdom
function _define_property(obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }
  return obj;
}
// MDN lists string|Blob|Promise<Blob|string> as possible types in ClipboardItemData
// lib.dom.d.ts lists only Promise<Blob|string>
// https://developer.mozilla.org/en-US/docs/Web/API/ClipboardItem/ClipboardItem#syntax
function createClipboardItem(window, ...blobs) {
  const dataMap = Object.fromEntries(blobs.map(b => [typeof b === 'string' ? 'text/plain' : b.type, Promise.resolve(b)]));
  // use real ClipboardItem if available
  /* istanbul ignore if */
  if (typeof window.ClipboardItem !== 'undefined') {
    return new window.ClipboardItem(dataMap);
  }
  return new class ClipboardItem {
    get types() {
      return Array.from(Object.keys(this.data));
    }
    async getType(type) {
      const value = await this.data[type];
      if (!value) {
        throw new Error(`${type} is not one of the available MIME types on this item.`);
      }
      return value instanceof window.Blob ? value : new window.Blob([value], {
        type
      });
    }
    constructor(d) {
      _define_property(this, "data", void 0);
      this.data = d;
    }
  }(dataMap);
}
const ClipboardStubControl = Symbol('Manage ClipboardSub');
function createClipboardStub(window, control) {
  return Object.assign(new class Clipboard extends window.EventTarget {
    async read() {
      return Array.from(this.items);
    }
    async readText() {
      let text = '';
      for (const item of this.items) {
        const type = item.types.includes('text/plain') ? 'text/plain' : item.types.find(t => t.startsWith('text/'));
        if (type) {
          text += await item.getType(type).then(b => Blob.readBlobText(b, window.FileReader));
        }
      }
      return text;
    }
    async write(data) {
      this.items = data;
    }
    async writeText(text) {
      this.items = [createClipboardItem(window, text)];
    }
    constructor(...args) {
      super(...args);
      _define_property(this, "items", []);
    }
  }(), {
    [ClipboardStubControl]: control
  });
}
function isClipboardStub(clipboard) {
  return !!(clipboard === null || clipboard === void 0 ? void 0 : clipboard[ClipboardStubControl]);
}
function attachClipboardStubToView(window) {
  if (isClipboardStub(window.navigator.clipboard)) {
    return window.navigator.clipboard[ClipboardStubControl];
  }
  const realClipboard = Object.getOwnPropertyDescriptor(window.navigator, 'clipboard');
  let stub;
  const control = {
    resetClipboardStub: () => {
      stub = createClipboardStub(window, control);
    },
    detachClipboardStub: () => {
      /* istanbul ignore if */if (realClipboard) {
        Object.defineProperty(window.navigator, 'clipboard', realClipboard);
      } else {
        Object.defineProperty(window.navigator, 'clipboard', {
          value: undefined,
          configurable: true
        });
      }
    }
  };
  stub = createClipboardStub(window, control);
  Object.defineProperty(window.navigator, 'clipboard', {
    get: () => stub,
    configurable: true
  });
  return stub[ClipboardStubControl];
}
function resetClipboardStubOnView(window) {
  if (isClipboardStub(window.navigator.clipboard)) {
    window.navigator.clipboard[ClipboardStubControl].resetClipboardStub();
  }
}
function detachClipboardStubFromView(window) {
  if (isClipboardStub(window.navigator.clipboard)) {
    window.navigator.clipboard[ClipboardStubControl].detachClipboardStub();
  }
}
async function readDataTransferFromClipboard(document) {
  const window = document.defaultView;
  const clipboard = window === null || window === void 0 ? void 0 : window.navigator.clipboard;
  const items = clipboard && (await clipboard.read());
  if (!items) {
    throw new Error('The Clipboard API is unavailable.');
  }
  const dt = DataTransfer.createDataTransfer(window);
  for (const item of items) {
    for (const type of item.types) {
      dt.setData(type, await item.getType(type).then(b => Blob.readBlobText(b, window.FileReader)));
    }
  }
  return dt;
}
async function writeDataTransferToClipboard(document, clipboardData) {
  const window = getWindow.getWindow(document);
  const clipboard = window.navigator.clipboard;
  const items = [];
  for (let i = 0; i < clipboardData.items.length; i++) {
    const dtItem = clipboardData.items[i];
    const blob = DataTransfer.getBlobFromDataTransferItem(window, dtItem);
    items.push(createClipboardItem(window, blob));
  }
  const written = clipboard && (await clipboard.write(items).then(() => true,
  // Can happen with other implementations that e.g. require permissions
  /* istanbul ignore next */
  () => false));
  if (!written) {
    throw new Error('The Clipboard API is unavailable.');
  }
}
const g = globalThis;
/* istanbul ignore else */
if (typeof g.afterEach === 'function') {
  g.afterEach(() => resetClipboardStubOnView(globalThis.window));
}
/* istanbul ignore else */
if (typeof g.afterAll === 'function') {
  g.afterAll(() => detachClipboardStubFromView(globalThis.window));
}
exports.attachClipboardStubToView = attachClipboardStubToView;
exports.createClipboardItem = createClipboardItem;
exports.detachClipboardStubFromView = detachClipboardStubFromView;
exports.readDataTransferFromClipboard = readDataTransferFromClipboard;
exports.resetClipboardStubOnView = resetClipboardStubOnView;
exports.writeDataTransferToClipboard = writeDataTransferToClipboard;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsImdldFdpbmRvdyIsInJlcXVpcmUiLCJCbG9iIiwiRGF0YVRyYW5zZmVyIiwiX2RlZmluZV9wcm9wZXJ0eSIsIm9iaiIsImtleSIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsImNyZWF0ZUNsaXBib2FyZEl0ZW0iLCJ3aW5kb3ciLCJibG9icyIsImRhdGFNYXAiLCJmcm9tRW50cmllcyIsIm1hcCIsImIiLCJ0eXBlIiwiUHJvbWlzZSIsInJlc29sdmUiLCJDbGlwYm9hcmRJdGVtIiwidHlwZXMiLCJBcnJheSIsImZyb20iLCJrZXlzIiwiZGF0YSIsImdldFR5cGUiLCJFcnJvciIsImNvbnN0cnVjdG9yIiwiZCIsIkNsaXBib2FyZFN0dWJDb250cm9sIiwiU3ltYm9sIiwiY3JlYXRlQ2xpcGJvYXJkU3R1YiIsImNvbnRyb2wiLCJhc3NpZ24iLCJDbGlwYm9hcmQiLCJFdmVudFRhcmdldCIsInJlYWQiLCJpdGVtcyIsInJlYWRUZXh0IiwidGV4dCIsIml0ZW0iLCJpbmNsdWRlcyIsImZpbmQiLCJ0Iiwic3RhcnRzV2l0aCIsInRoZW4iLCJyZWFkQmxvYlRleHQiLCJGaWxlUmVhZGVyIiwid3JpdGUiLCJ3cml0ZVRleHQiLCJhcmdzIiwiaXNDbGlwYm9hcmRTdHViIiwiY2xpcGJvYXJkIiwiYXR0YWNoQ2xpcGJvYXJkU3R1YlRvVmlldyIsIm5hdmlnYXRvciIsInJlYWxDbGlwYm9hcmQiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJzdHViIiwicmVzZXRDbGlwYm9hcmRTdHViIiwiZGV0YWNoQ2xpcGJvYXJkU3R1YiIsInVuZGVmaW5lZCIsImdldCIsInJlc2V0Q2xpcGJvYXJkU3R1Yk9uVmlldyIsImRldGFjaENsaXBib2FyZFN0dWJGcm9tVmlldyIsInJlYWREYXRhVHJhbnNmZXJGcm9tQ2xpcGJvYXJkIiwiZG9jdW1lbnQiLCJkZWZhdWx0VmlldyIsImR0IiwiY3JlYXRlRGF0YVRyYW5zZmVyIiwic2V0RGF0YSIsIndyaXRlRGF0YVRyYW5zZmVyVG9DbGlwYm9hcmQiLCJjbGlwYm9hcmREYXRhIiwiaSIsImxlbmd0aCIsImR0SXRlbSIsImJsb2IiLCJnZXRCbG9iRnJvbURhdGFUcmFuc2Zlckl0ZW0iLCJwdXNoIiwid3JpdHRlbiIsImciLCJnbG9iYWxUaGlzIiwiYWZ0ZXJFYWNoIiwiYWZ0ZXJBbGwiXSwic291cmNlcyI6WyJDbGlwYm9hcmQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuXG52YXIgZ2V0V2luZG93ID0gcmVxdWlyZSgnLi4vbWlzYy9nZXRXaW5kb3cuanMnKTtcbnZhciBCbG9iID0gcmVxdWlyZSgnLi9CbG9iLmpzJyk7XG52YXIgRGF0YVRyYW5zZmVyID0gcmVxdWlyZSgnLi9EYXRhVHJhbnNmZXIuanMnKTtcblxuLy8gQ2xpcGJvYXJkIGlzIG5vdCBhdmFpbGFibGUgaW4ganNkb21cbmZ1bmN0aW9uIF9kZWZpbmVfcHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7XG4gICAgaWYgKGtleSBpbiBvYmopIHtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7XG4gICAgICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgd3JpdGFibGU6IHRydWVcbiAgICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgb2JqW2tleV0gPSB2YWx1ZTtcbiAgICB9XG4gICAgcmV0dXJuIG9iajtcbn1cbi8vIE1ETiBsaXN0cyBzdHJpbmd8QmxvYnxQcm9taXNlPEJsb2J8c3RyaW5nPiBhcyBwb3NzaWJsZSB0eXBlcyBpbiBDbGlwYm9hcmRJdGVtRGF0YVxuLy8gbGliLmRvbS5kLnRzIGxpc3RzIG9ubHkgUHJvbWlzZTxCbG9ifHN0cmluZz5cbi8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9DbGlwYm9hcmRJdGVtL0NsaXBib2FyZEl0ZW0jc3ludGF4XG5mdW5jdGlvbiBjcmVhdGVDbGlwYm9hcmRJdGVtKHdpbmRvdywgLi4uYmxvYnMpIHtcbiAgICBjb25zdCBkYXRhTWFwID0gT2JqZWN0LmZyb21FbnRyaWVzKGJsb2JzLm1hcCgoYik9PltcbiAgICAgICAgICAgIHR5cGVvZiBiID09PSAnc3RyaW5nJyA/ICd0ZXh0L3BsYWluJyA6IGIudHlwZSxcbiAgICAgICAgICAgIFByb21pc2UucmVzb2x2ZShiKVxuICAgICAgICBdKSk7XG4gICAgLy8gdXNlIHJlYWwgQ2xpcGJvYXJkSXRlbSBpZiBhdmFpbGFibGVcbiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8gaWYgKHR5cGVvZiB3aW5kb3cuQ2xpcGJvYXJkSXRlbSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgcmV0dXJuIG5ldyB3aW5kb3cuQ2xpcGJvYXJkSXRlbShkYXRhTWFwKTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBjbGFzcyBDbGlwYm9hcmRJdGVtIHtcbiAgICAgICAgZ2V0IHR5cGVzKCkge1xuICAgICAgICAgICAgcmV0dXJuIEFycmF5LmZyb20oT2JqZWN0LmtleXModGhpcy5kYXRhKSk7XG4gICAgICAgIH1cbiAgICAgICAgYXN5bmMgZ2V0VHlwZSh0eXBlKSB7XG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGF3YWl0IHRoaXMuZGF0YVt0eXBlXTtcbiAgICAgICAgICAgIGlmICghdmFsdWUpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7dHlwZX0gaXMgbm90IG9uZSBvZiB0aGUgYXZhaWxhYmxlIE1JTUUgdHlwZXMgb24gdGhpcyBpdGVtLmApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2Ygd2luZG93LkJsb2IgPyB2YWx1ZSA6IG5ldyB3aW5kb3cuQmxvYihbXG4gICAgICAgICAgICAgICAgdmFsdWVcbiAgICAgICAgICAgIF0sIHtcbiAgICAgICAgICAgICAgICB0eXBlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdHJ1Y3RvcihkKXtcbiAgICAgICAgICAgIF9kZWZpbmVfcHJvcGVydHkodGhpcywgXCJkYXRhXCIsIHZvaWQgMCk7XG4gICAgICAgICAgICB0aGlzLmRhdGEgPSBkO1xuICAgICAgICB9XG4gICAgfShkYXRhTWFwKTtcbn1cbmNvbnN0IENsaXBib2FyZFN0dWJDb250cm9sID0gU3ltYm9sKCdNYW5hZ2UgQ2xpcGJvYXJkU3ViJyk7XG5mdW5jdGlvbiBjcmVhdGVDbGlwYm9hcmRTdHViKHdpbmRvdywgY29udHJvbCkge1xuICAgIHJldHVybiBPYmplY3QuYXNzaWduKG5ldyBjbGFzcyBDbGlwYm9hcmQgZXh0ZW5kcyB3aW5kb3cuRXZlbnRUYXJnZXQge1xuICAgICAgICBhc3luYyByZWFkKCkge1xuICAgICAgICAgICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5pdGVtcyk7XG4gICAgICAgIH1cbiAgICAgICAgYXN5bmMgcmVhZFRleHQoKSB7XG4gICAgICAgICAgICBsZXQgdGV4dCA9ICcnO1xuICAgICAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIHRoaXMuaXRlbXMpe1xuICAgICAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBpdGVtLnR5cGVzLmluY2x1ZGVzKCd0ZXh0L3BsYWluJykgPyAndGV4dC9wbGFpbicgOiBpdGVtLnR5cGVzLmZpbmQoKHQpPT50LnN0YXJ0c1dpdGgoJ3RleHQvJykpO1xuICAgICAgICAgICAgICAgIGlmICh0eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRleHQgKz0gYXdhaXQgaXRlbS5nZXRUeXBlKHR5cGUpLnRoZW4oKGIpPT5CbG9iLnJlYWRCbG9iVGV4dChiLCB3aW5kb3cuRmlsZVJlYWRlcikpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0ZXh0O1xuICAgICAgICB9XG4gICAgICAgIGFzeW5jIHdyaXRlKGRhdGEpIHtcbiAgICAgICAgICAgIHRoaXMuaXRlbXMgPSBkYXRhO1xuICAgICAgICB9XG4gICAgICAgIGFzeW5jIHdyaXRlVGV4dCh0ZXh0KSB7XG4gICAgICAgICAgICB0aGlzLml0ZW1zID0gW1xuICAgICAgICAgICAgICAgIGNyZWF0ZUNsaXBib2FyZEl0ZW0od2luZG93LCB0ZXh0KVxuICAgICAgICAgICAgXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdHJ1Y3RvciguLi5hcmdzKXtcbiAgICAgICAgICAgIHN1cGVyKC4uLmFyZ3MpO1xuICAgICAgICAgICAgX2RlZmluZV9wcm9wZXJ0eSh0aGlzLCBcIml0ZW1zXCIsIFtdKTtcbiAgICAgICAgfVxuICAgIH0oKSwge1xuICAgICAgICBbQ2xpcGJvYXJkU3R1YkNvbnRyb2xdOiBjb250cm9sXG4gICAgfSk7XG59XG5mdW5jdGlvbiBpc0NsaXBib2FyZFN0dWIoY2xpcGJvYXJkKSB7XG4gICAgcmV0dXJuICEhKGNsaXBib2FyZCA9PT0gbnVsbCB8fCBjbGlwYm9hcmQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNsaXBib2FyZFtDbGlwYm9hcmRTdHViQ29udHJvbF0pO1xufVxuZnVuY3Rpb24gYXR0YWNoQ2xpcGJvYXJkU3R1YlRvVmlldyh3aW5kb3cpIHtcbiAgICBpZiAoaXNDbGlwYm9hcmRTdHViKHdpbmRvdy5uYXZpZ2F0b3IuY2xpcGJvYXJkKSkge1xuICAgICAgICByZXR1cm4gd2luZG93Lm5hdmlnYXRvci5jbGlwYm9hcmRbQ2xpcGJvYXJkU3R1YkNvbnRyb2xdO1xuICAgIH1cbiAgICBjb25zdCByZWFsQ2xpcGJvYXJkID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih3aW5kb3cubmF2aWdhdG9yLCAnY2xpcGJvYXJkJyk7XG4gICAgbGV0IHN0dWI7XG4gICAgY29uc3QgY29udHJvbCA9IHtcbiAgICAgICAgcmVzZXRDbGlwYm9hcmRTdHViOiAoKT0+e1xuICAgICAgICAgICAgc3R1YiA9IGNyZWF0ZUNsaXBib2FyZFN0dWIod2luZG93LCBjb250cm9sKTtcbiAgICAgICAgfSxcbiAgICAgICAgZGV0YWNoQ2xpcGJvYXJkU3R1YjogKCk9PntcbiAgICAgICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLyBpZiAocmVhbENsaXBib2FyZCkge1xuICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3cubmF2aWdhdG9yLCAnY2xpcGJvYXJkJywgcmVhbENsaXBib2FyZCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3cubmF2aWdhdG9yLCAnY2xpcGJvYXJkJywge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgc3R1YiA9IGNyZWF0ZUNsaXBib2FyZFN0dWIod2luZG93LCBjb250cm9sKTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93Lm5hdmlnYXRvciwgJ2NsaXBib2FyZCcsIHtcbiAgICAgICAgZ2V0OiAoKT0+c3R1YixcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgcmV0dXJuIHN0dWJbQ2xpcGJvYXJkU3R1YkNvbnRyb2xdO1xufVxuZnVuY3Rpb24gcmVzZXRDbGlwYm9hcmRTdHViT25WaWV3KHdpbmRvdykge1xuICAgIGlmIChpc0NsaXBib2FyZFN0dWIod2luZG93Lm5hdmlnYXRvci5jbGlwYm9hcmQpKSB7XG4gICAgICAgIHdpbmRvdy5uYXZpZ2F0b3IuY2xpcGJvYXJkW0NsaXBib2FyZFN0dWJDb250cm9sXS5yZXNldENsaXBib2FyZFN0dWIoKTtcbiAgICB9XG59XG5mdW5jdGlvbiBkZXRhY2hDbGlwYm9hcmRTdHViRnJvbVZpZXcod2luZG93KSB7XG4gICAgaWYgKGlzQ2xpcGJvYXJkU3R1Yih3aW5kb3cubmF2aWdhdG9yLmNsaXBib2FyZCkpIHtcbiAgICAgICAgd2luZG93Lm5hdmlnYXRvci5jbGlwYm9hcmRbQ2xpcGJvYXJkU3R1YkNvbnRyb2xdLmRldGFjaENsaXBib2FyZFN0dWIoKTtcbiAgICB9XG59XG5hc3luYyBmdW5jdGlvbiByZWFkRGF0YVRyYW5zZmVyRnJvbUNsaXBib2FyZChkb2N1bWVudCkge1xuICAgIGNvbnN0IHdpbmRvdyA9IGRvY3VtZW50LmRlZmF1bHRWaWV3O1xuICAgIGNvbnN0IGNsaXBib2FyZCA9IHdpbmRvdyA9PT0gbnVsbCB8fCB3aW5kb3cgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHdpbmRvdy5uYXZpZ2F0b3IuY2xpcGJvYXJkO1xuICAgIGNvbnN0IGl0ZW1zID0gY2xpcGJvYXJkICYmIGF3YWl0IGNsaXBib2FyZC5yZWFkKCk7XG4gICAgaWYgKCFpdGVtcykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBDbGlwYm9hcmQgQVBJIGlzIHVuYXZhaWxhYmxlLicpO1xuICAgIH1cbiAgICBjb25zdCBkdCA9IERhdGFUcmFuc2Zlci5jcmVhdGVEYXRhVHJhbnNmZXIod2luZG93KTtcbiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgaXRlbXMpe1xuICAgICAgICBmb3IgKGNvbnN0IHR5cGUgb2YgaXRlbS50eXBlcyl7XG4gICAgICAgICAgICBkdC5zZXREYXRhKHR5cGUsIGF3YWl0IGl0ZW0uZ2V0VHlwZSh0eXBlKS50aGVuKChiKT0+QmxvYi5yZWFkQmxvYlRleHQoYiwgd2luZG93LkZpbGVSZWFkZXIpKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGR0O1xufVxuYXN5bmMgZnVuY3Rpb24gd3JpdGVEYXRhVHJhbnNmZXJUb0NsaXBib2FyZChkb2N1bWVudCwgY2xpcGJvYXJkRGF0YSkge1xuICAgIGNvbnN0IHdpbmRvdyA9IGdldFdpbmRvdy5nZXRXaW5kb3coZG9jdW1lbnQpO1xuICAgIGNvbnN0IGNsaXBib2FyZCA9IHdpbmRvdy5uYXZpZ2F0b3IuY2xpcGJvYXJkO1xuICAgIGNvbnN0IGl0ZW1zID0gW107XG4gICAgZm9yKGxldCBpID0gMDsgaSA8IGNsaXBib2FyZERhdGEuaXRlbXMubGVuZ3RoOyBpKyspe1xuICAgICAgICBjb25zdCBkdEl0ZW0gPSBjbGlwYm9hcmREYXRhLml0ZW1zW2ldO1xuICAgICAgICBjb25zdCBibG9iID0gRGF0YVRyYW5zZmVyLmdldEJsb2JGcm9tRGF0YVRyYW5zZmVySXRlbSh3aW5kb3csIGR0SXRlbSk7XG4gICAgICAgIGl0ZW1zLnB1c2goY3JlYXRlQ2xpcGJvYXJkSXRlbSh3aW5kb3csIGJsb2IpKTtcbiAgICB9XG4gICAgY29uc3Qgd3JpdHRlbiA9IGNsaXBib2FyZCAmJiBhd2FpdCBjbGlwYm9hcmQud3JpdGUoaXRlbXMpLnRoZW4oKCk9PnRydWUsIC8vIENhbiBoYXBwZW4gd2l0aCBvdGhlciBpbXBsZW1lbnRhdGlvbnMgdGhhdCBlLmcuIHJlcXVpcmUgcGVybWlzc2lvbnNcbiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLyAoKT0+ZmFsc2UpO1xuICAgIGlmICghd3JpdHRlbikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBDbGlwYm9hcmQgQVBJIGlzIHVuYXZhaWxhYmxlLicpO1xuICAgIH1cbn1cbmNvbnN0IGcgPSBnbG9iYWxUaGlzO1xuLyogaXN0YW5idWwgaWdub3JlIGVsc2UgKi8gaWYgKHR5cGVvZiBnLmFmdGVyRWFjaCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIGcuYWZ0ZXJFYWNoKCgpPT5yZXNldENsaXBib2FyZFN0dWJPblZpZXcoZ2xvYmFsVGhpcy53aW5kb3cpKTtcbn1cbi8qIGlzdGFuYnVsIGlnbm9yZSBlbHNlICovIGlmICh0eXBlb2YgZy5hZnRlckFsbCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIGcuYWZ0ZXJBbGwoKCk9PmRldGFjaENsaXBib2FyZFN0dWJGcm9tVmlldyhnbG9iYWxUaGlzLndpbmRvdykpO1xufVxuXG5leHBvcnRzLmF0dGFjaENsaXBib2FyZFN0dWJUb1ZpZXcgPSBhdHRhY2hDbGlwYm9hcmRTdHViVG9WaWV3O1xuZXhwb3J0cy5jcmVhdGVDbGlwYm9hcmRJdGVtID0gY3JlYXRlQ2xpcGJvYXJkSXRlbTtcbmV4cG9ydHMuZGV0YWNoQ2xpcGJvYXJkU3R1YkZyb21WaWV3ID0gZGV0YWNoQ2xpcGJvYXJkU3R1YkZyb21WaWV3O1xuZXhwb3J0cy5yZWFkRGF0YVRyYW5zZmVyRnJvbUNsaXBib2FyZCA9IHJlYWREYXRhVHJhbnNmZXJGcm9tQ2xpcGJvYXJkO1xuZXhwb3J0cy5yZXNldENsaXBib2FyZFN0dWJPblZpZXcgPSByZXNldENsaXBib2FyZFN0dWJPblZpZXc7XG5leHBvcnRzLndyaXRlRGF0YVRyYW5zZmVyVG9DbGlwYm9hcmQgPSB3cml0ZURhdGFUcmFuc2ZlclRvQ2xpcGJvYXJkO1xuIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUFZOztBQUVaQSxNQUFNLENBQUNDLGNBQWMsQ0FBQ0MsT0FBTyxFQUFFLFlBQVksRUFBRTtFQUFFQyxLQUFLLEVBQUU7QUFBSyxDQUFDLENBQUM7QUFFN0QsSUFBSUMsU0FBUyxHQUFHQyxPQUFPLENBQUMsc0JBQXNCLENBQUM7QUFDL0MsSUFBSUMsSUFBSSxHQUFHRCxPQUFPLENBQUMsV0FBVyxDQUFDO0FBQy9CLElBQUlFLFlBQVksR0FBR0YsT0FBTyxDQUFDLG1CQUFtQixDQUFDOztBQUUvQztBQUNBLFNBQVNHLGdCQUFnQkEsQ0FBQ0MsR0FBRyxFQUFFQyxHQUFHLEVBQUVQLEtBQUssRUFBRTtFQUN2QyxJQUFJTyxHQUFHLElBQUlELEdBQUcsRUFBRTtJQUNaVCxNQUFNLENBQUNDLGNBQWMsQ0FBQ1EsR0FBRyxFQUFFQyxHQUFHLEVBQUU7TUFDNUJQLEtBQUssRUFBRUEsS0FB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