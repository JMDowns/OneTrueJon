{"version":3,"names":["Object","defineProperty","exports","value","UI","require","selection","resolveCaretPosition","setSelectionPerMouseDown","document","target","clickCount","node","offset","hasNoSelection","targetHasOwnSelection","hasOwnSelection","text","String","getUIValue","textContent","start","end","getTextRange","setUISelection","anchorOffset","length","focusOffset","startNode","startOffset","endNode","endOffset","range","ownerDocument","createRange","setStart","setEnd","e","Error","getSelection","removeAllRanges","addRange","cloneRange","pos","textPos","substr","match","undefined"],"sources":["setSelectionPerMouse.js"],"sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar UI = require('../../document/UI.js');\nrequire('../../utils/click/isClickableInput.js');\nrequire('../../utils/dataTransfer/Clipboard.js');\nrequire('../../utils/edit/isEditable.js');\nrequire('../../utils/edit/maxLength.js');\nrequire('@testing-library/dom/dist/helpers.js');\nvar selection = require('../../utils/focus/selection.js');\nrequire('../../utils/keyDef/readNextDescriptor.js');\nrequire('../../utils/misc/level.js');\nrequire('../../options.js');\nvar resolveCaretPosition = require('./resolveCaretPosition.js');\n\nfunction setSelectionPerMouseDown({ document, target, clickCount, node, offset }) {\n    if (selection.hasNoSelection(target)) {\n        return;\n    }\n    const targetHasOwnSelection = selection.hasOwnSelection(target);\n    // On non-input elements the text selection per multiple click\n    // can extend beyond the target boundaries.\n    // The exact mechanism what is considered in the same line is unclear.\n    // Looks it might be every inline element.\n    // TODO: Check what might be considered part of the same line of text.\n    const text = String(targetHasOwnSelection ? UI.getUIValue(target) : target.textContent);\n    const [start, end] = node ? // which elements might be considered in the same line of text.\n    // TODO: support expanding initial range on multiple clicks if node is given\n    [\n        offset,\n        offset\n    ] : getTextRange(text, offset, clickCount);\n    // TODO: implement modifying selection per shift/ctrl+mouse\n    if (targetHasOwnSelection) {\n        UI.setUISelection(target, {\n            anchorOffset: start !== null && start !== void 0 ? start : text.length,\n            focusOffset: end !== null && end !== void 0 ? end : text.length\n        });\n        return {\n            node: target,\n            start: start !== null && start !== void 0 ? start : 0,\n            end: end !== null && end !== void 0 ? end : text.length\n        };\n    } else {\n        const { node: startNode, offset: startOffset } = resolveCaretPosition.resolveCaretPosition({\n            target,\n            node,\n            offset: start\n        });\n        const { node: endNode, offset: endOffset } = resolveCaretPosition.resolveCaretPosition({\n            target,\n            node,\n            offset: end\n        });\n        const range = target.ownerDocument.createRange();\n        try {\n            range.setStart(startNode, startOffset);\n            range.setEnd(endNode, endOffset);\n        } catch (e) {\n            throw new Error('The given offset is out of bounds.');\n        }\n        const selection = document.getSelection();\n        selection === null || selection === void 0 ? void 0 : selection.removeAllRanges();\n        selection === null || selection === void 0 ? void 0 : selection.addRange(range.cloneRange());\n        return range;\n    }\n}\nfunction getTextRange(text, pos, clickCount) {\n    if (clickCount % 3 === 1 || text.length === 0) {\n        return [\n            pos,\n            pos\n        ];\n    }\n    const textPos = pos !== null && pos !== void 0 ? pos : text.length;\n    if (clickCount % 3 === 2) {\n        return [\n            textPos - text.substr(0, pos).match(/(\\w+|\\s+|\\W)?$/)[0].length,\n            pos === undefined ? pos : pos + text.substr(pos).match(/^(\\w+|\\s+|\\W)?/)[0].length\n        ];\n    }\n    // triple click\n    return [\n        textPos - text.substr(0, pos).match(/[^\\r\\n]*$/)[0].length,\n        pos === undefined ? pos : pos + text.substr(pos).match(/^[^\\r\\n]*/)[0].length\n    ];\n}\n\nexports.setSelectionPerMouseDown = setSelectionPerMouseDown;\n"],"mappings":"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"}