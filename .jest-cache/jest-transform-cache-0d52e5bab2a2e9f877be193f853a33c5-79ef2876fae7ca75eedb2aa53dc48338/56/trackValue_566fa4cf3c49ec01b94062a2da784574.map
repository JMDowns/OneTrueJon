{"version":3,"names":["Object","defineProperty","exports","value","require","getWindow","UI","TrackChanges","Symbol","isReact17Element","element","getOwnPropertyNames","some","k","startsWith","REACT_VERSION","startTrackValue","previousValue","String","tracked","trackOrSetValue","v","_element_TrackChanges_tracked","_element_TrackChanges","push","setUIValueClean","setUISelection","focusOffset","length","commitValueAfterInput","cursorOffset","_changes_tracked","changes","undefined","isJustReactStateUpdate","hasUISelection"],"sources":["trackValue.js"],"sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nrequire('../utils/click/isClickableInput.js');\nrequire('../utils/dataTransfer/Clipboard.js');\nrequire('../utils/edit/isEditable.js');\nrequire('../utils/edit/maxLength.js');\nvar getWindow = require('../utils/misc/getWindow.js');\nrequire('../utils/keyDef/readNextDescriptor.js');\nrequire('../utils/misc/level.js');\nrequire('../options.js');\nvar UI = require('./UI.js');\n\nconst TrackChanges = Symbol('Track programmatic changes for React workaround');\n// When the input event happens in the browser, React executes all event handlers\n// and if they change state of a controlled value, nothing happens.\n// But when we trigger the event handlers in test environment with React@17,\n// the changes are rolled back before the state update is applied.\n// This results in a reset cursor.\n// There might be a better way to work around if we figure out\n// why the batched update is executed differently in our test environment.\nfunction isReact17Element(element) {\n    return Object.getOwnPropertyNames(element).some((k)=>k.startsWith('__react')) && getWindow.getWindow(element).REACT_VERSION === 17;\n}\nfunction startTrackValue(element) {\n    if (!isReact17Element(element)) {\n        return;\n    }\n    element[TrackChanges] = {\n        previousValue: String(element.value),\n        tracked: []\n    };\n}\nfunction trackOrSetValue(element, v) {\n    var _element_TrackChanges_tracked, _element_TrackChanges;\n    (_element_TrackChanges = element[TrackChanges]) === null || _element_TrackChanges === void 0 ? void 0 : (_element_TrackChanges_tracked = _element_TrackChanges.tracked) === null || _element_TrackChanges_tracked === void 0 ? void 0 : _element_TrackChanges_tracked.push(v);\n    if (!element[TrackChanges]) {\n        UI.setUIValueClean(element);\n        UI.setUISelection(element, {\n            focusOffset: v.length\n        });\n    }\n}\nfunction commitValueAfterInput(element, cursorOffset) {\n    var _changes_tracked;\n    const changes = element[TrackChanges];\n    element[TrackChanges] = undefined;\n    if (!(changes === null || changes === void 0 ? void 0 : (_changes_tracked = changes.tracked) === null || _changes_tracked === void 0 ? void 0 : _changes_tracked.length)) {\n        return;\n    }\n    const isJustReactStateUpdate = changes.tracked.length === 2 && changes.tracked[0] === changes.previousValue && changes.tracked[1] === element.value;\n    if (!isJustReactStateUpdate) {\n        UI.setUIValueClean(element);\n    }\n    if (UI.hasUISelection(element)) {\n        UI.setUISelection(element, {\n            focusOffset: isJustReactStateUpdate ? cursorOffset : element.value.length\n        });\n    }\n}\n\nexports.commitValueAfterInput = commitValueAfterInput;\nexports.startTrackValue = startTrackValue;\nexports.trackOrSetValue = trackOrSetValue;\n"],"mappings":"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"}